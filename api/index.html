
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="This is a simple example python package.">
      
      
      
      
        <link rel="prev" href="../reference/">
      
      
      
      <link rel="icon" href="../assets/images/favicon.png">
      <meta name="generator" content="mkdocs-1.5.3, mkdocs-material-9.5.18">
    
    
      
        <title>API - aprofs Package</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.66ac8b77.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.06af60db.min.css">
      
      


    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../assets/_mkdocstrings.css">
    
    <script>__md_scope=new URL("..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#references" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href=".." title="aprofs Package" class="md-header__button md-logo" aria-label="aprofs Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            aprofs Package
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              API
            
          </span>
        </div>
      </div>
    </div>
    
      
        <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: light)" data-md-color-scheme="default" data-md-color-primary="blue" data-md-color-accent="grey"  aria-label="Switch to dark mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to dark mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 6H7c-3.31 0-6 2.69-6 6s2.69 6 6 6h10c3.31 0 6-2.69 6-6s-2.69-6-6-6zm0 10H7c-2.21 0-4-1.79-4-4s1.79-4 4-4h10c2.21 0 4 1.79 4 4s-1.79 4-4 4zM7 9c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="(prefers-color-scheme: dark)" data-md-color-scheme="slate" data-md-color-primary="blue" data-md-color-accent="white"  aria-label="Switch to light mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to light mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M17 7H7a5 5 0 0 0-5 5 5 5 0 0 0 5 5h10a5 5 0 0 0 5-5 5 5 0 0 0-5-5m0 8a3 3 0 0 1-3-3 3 3 0 0 1 3-3 3 3 0 0 1 3 3 3 3 0 0 1-3 3Z"/></svg>
      </label>
    
  
</form>
      
    
    
      <script>var media,input,key,value,palette=__md_get("__palette");if(palette&&palette.color){"(prefers-color-scheme)"===palette.color.media&&(media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']"),palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent"));for([key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/blewy/aprofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aprofs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    



<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="aprofs Package" class="md-nav__button md-logo" aria-label="aprofs Package" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 8a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3 3 3 0 0 0 3 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54Z"/></svg>

    </a>
    aprofs Package
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/blewy/aprofs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 496 512"><!--! Font Awesome Free 6.5.2 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2024 Fonticons, Inc.--><path d="M165.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6zm-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3zm44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9zM244.8 8C106.1 8 0 113.3 0 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C428.2 457.8 496 362.9 496 252 496 113.3 383.5 8 244.8 8zM97.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1zm-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7zm32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1zm-11.4-14.7c-1.6 1-1.6 3.6 0 5.9 1.6 2.3 4.3 3.3 5.6 2.3 1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2z"/></svg>
  </div>
  <div class="md-source__repository">
    aprofs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href=".." class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Start
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../Tutorial/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Tutorial
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../guide/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Guides
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../reference/" class="md-nav__link">
        
  
  <span class="md-ellipsis">
    Reference
  </span>
  

      </a>
    </li>
  

    
      
      
  
  
    
  
  
  
    <li class="md-nav__item md-nav__item--active">
      
      <input class="md-nav__toggle md-toggle" type="checkbox" id="__toc">
      
      
        
      
      
        <label class="md-nav__link md-nav__link--active" for="__toc">
          
  
  <span class="md-ellipsis">
    API
  </span>
  

          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <a href="./" class="md-nav__link md-nav__link--active">
        
  
  <span class="md-ellipsis">
    API
  </span>
  

      </a>
      
        

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.code" class="md-nav__link">
    <span class="md-ellipsis">
      code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs" class="md-nav__link">
    <span class="md-ellipsis">
      Aprofs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aprofs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs--a-class-for-analyzing-shap-values-using-approximate-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      A class for analyzing SHAP values using approximate predictions.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.brute_force_selection" class="md-nav__link">
    <span class="md-ellipsis">
      brute_force_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.calculate_shaps" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_shaps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.compare_feature" class="md-nav__link">
    <span class="md-ellipsis">
      compare_feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.get_feature_performance" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.get_shap_p_value" class="md-nav__link">
    <span class="md-ellipsis">
      get_shap_p_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.gready_forward_selection" class="md-nav__link">
    <span class="md-ellipsis">
      gready_forward_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.visualize_feature" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.visualize_neutralized_feature" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_neutralized_feature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-api-models" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed API models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.ClassificationLogisticLink" class="md-nav__link">
    <span class="md-ellipsis">
      ClassificationLogisticLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels" class="md-nav__link">
    <span class="md-ellipsis">
      LinkModels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LinkModels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels.inv_link_calculate" class="md-nav__link">
    <span class="md-ellipsis">
      inv_link_calculate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels.link_calculate" class="md-nav__link">
    <span class="md-ellipsis">
      link_calculate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels.performance_fit" class="md-nav__link">
    <span class="md-ellipsis">
      performance_fit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.RegressionIdentityLink" class="md-nav__link">
    <span class="md-ellipsis">
      RegressionIdentityLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.RegressionLogLink" class="md-nav__link">
    <span class="md-ellipsis">
      RegressionLogLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-api-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed API utilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.best_feature" class="md-nav__link">
    <span class="md-ellipsis">
      best_feature
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.calculate_all_row_sum" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_all_row_sum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.calculate_row_sum" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_row_sum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.generate_all_combinations" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_combinations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.get_shap_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_shap_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.plot_data" class="md-nav__link">
    <span class="md-ellipsis">
      plot_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.plot_data_compare" class="md-nav__link">
    <span class="md-ellipsis">
      plot_data_compare
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.plot_data_neutral" class="md-nav__link">
    <span class="md-ellipsis">
      plot_data_neutral
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.random_sort_shaps" class="md-nav__link">
    <span class="md-ellipsis">
      random_sort_shaps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.random_sort_shaps_column" class="md-nav__link">
    <span class="md-ellipsis">
      random_sort_shaps_column
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.temp_neutral_plot_data" class="md-nav__link">
    <span class="md-ellipsis">
      temp_neutral_plot_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.temp_plot_compare_data" class="md-nav__link">
    <span class="md-ellipsis">
      temp_plot_compare_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.temp_plot_data" class="md-nav__link">
    <span class="md-ellipsis">
      temp_plot_data
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.code" class="md-nav__link">
    <span class="md-ellipsis">
      code
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs" class="md-nav__link">
    <span class="md-ellipsis">
      Aprofs
    </span>
  </a>
  
    <nav class="md-nav" aria-label="Aprofs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs--a-class-for-analyzing-shap-values-using-approximate-predictions" class="md-nav__link">
    <span class="md-ellipsis">
      A class for analyzing SHAP values using approximate predictions.
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.brute_force_selection" class="md-nav__link">
    <span class="md-ellipsis">
      brute_force_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.calculate_shaps" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_shaps
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.compare_feature" class="md-nav__link">
    <span class="md-ellipsis">
      compare_feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.get_feature_performance" class="md-nav__link">
    <span class="md-ellipsis">
      get_feature_performance
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.get_shap_p_value" class="md-nav__link">
    <span class="md-ellipsis">
      get_shap_p_value
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.gready_forward_selection" class="md-nav__link">
    <span class="md-ellipsis">
      gready_forward_selection
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.visualize_feature" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_feature
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.code.Aprofs.visualize_neutralized_feature" class="md-nav__link">
    <span class="md-ellipsis">
      visualize_neutralized_feature
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-api-models" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed API models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models" class="md-nav__link">
    <span class="md-ellipsis">
      models
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.ClassificationLogisticLink" class="md-nav__link">
    <span class="md-ellipsis">
      ClassificationLogisticLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels" class="md-nav__link">
    <span class="md-ellipsis">
      LinkModels
    </span>
  </a>
  
    <nav class="md-nav" aria-label="LinkModels">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels.inv_link_calculate" class="md-nav__link">
    <span class="md-ellipsis">
      inv_link_calculate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels.link_calculate" class="md-nav__link">
    <span class="md-ellipsis">
      link_calculate
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#src.aprofs.models.LinkModels.performance_fit" class="md-nav__link">
    <span class="md-ellipsis">
      performance_fit
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.RegressionIdentityLink" class="md-nav__link">
    <span class="md-ellipsis">
      RegressionIdentityLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.models.RegressionLogLink" class="md-nav__link">
    <span class="md-ellipsis">
      RegressionLogLink
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#detailed-api-utilities" class="md-nav__link">
    <span class="md-ellipsis">
      Detailed API utilities
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils" class="md-nav__link">
    <span class="md-ellipsis">
      utils
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.best_feature" class="md-nav__link">
    <span class="md-ellipsis">
      best_feature
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.calculate_all_row_sum" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_all_row_sum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.calculate_row_sum" class="md-nav__link">
    <span class="md-ellipsis">
      calculate_row_sum
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.generate_all_combinations" class="md-nav__link">
    <span class="md-ellipsis">
      generate_all_combinations
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.get_shap_values" class="md-nav__link">
    <span class="md-ellipsis">
      get_shap_values
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.plot_data" class="md-nav__link">
    <span class="md-ellipsis">
      plot_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.plot_data_compare" class="md-nav__link">
    <span class="md-ellipsis">
      plot_data_compare
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.plot_data_neutral" class="md-nav__link">
    <span class="md-ellipsis">
      plot_data_neutral
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.random_sort_shaps" class="md-nav__link">
    <span class="md-ellipsis">
      random_sort_shaps
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.random_sort_shaps_column" class="md-nav__link">
    <span class="md-ellipsis">
      random_sort_shaps_column
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.temp_neutral_plot_data" class="md-nav__link">
    <span class="md-ellipsis">
      temp_neutral_plot_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.temp_plot_compare_data" class="md-nav__link">
    <span class="md-ellipsis">
      temp_plot_compare_data
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#src.aprofs.utils.temp_plot_data" class="md-nav__link">
    <span class="md-ellipsis">
      temp_plot_data
    </span>
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  

  
  


<h1 id="references">References</h1>


<div class="doc doc-object doc-module">



<a id="src.aprofs.code"></a>
  <div class="doc doc-contents first">
  
      <p>Core code development of the Aprofs class.</p>
<p>This class is used to calculate the SHAP values of a model and
evaluate the performance of the features based on the SHAP values. The class also provides a method to
visualize the marginal effect of a feature on the target variable. The class is used to perform feature
selection based on the SHAP values and to calculate the p-values of the SHAP values of the features.
The class is also used to calculate the performance of the model based on the SHAP values of the features.</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.aprofs.code.Aprofs" class="doc doc-heading">
          <code>Aprofs</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>Aprofs Class</p>
<h4 id="src.aprofs.code.Aprofs--a-class-for-analyzing-shap-values-using-approximate-predictions">A class for analyzing SHAP values using approximate predictions.</h4>



  <p><span class="doc-section-title">Attributes:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code><span title="src.aprofs.code.Aprofs.current_data">current_data</span></code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The current data.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.aprofs.code.Aprofs.target_column">target_column</span></code></td>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target column.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.aprofs.code.Aprofs.link">link</span></code></td>
          <td>
                <code>function</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The link function.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.aprofs.code.Aprofs.link_srt">link_srt</span></code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The string representation of the link function.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.aprofs.code.Aprofs.shap_mean">shap_mean</span></code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mean SHAP value. None if SHAP values have not been calculated.</p>
            </div>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code><span title="src.aprofs.code.Aprofs.shap_values">shap_values</span></code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The SHAP values. None if SHAP values have not been calculated.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

            <details class="quote">
              <summary>Source code in <code>src/aprofs/code.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 28</span>
<span class="normal"> 29</span>
<span class="normal"> 30</span>
<span class="normal"> 31</span>
<span class="normal"> 32</span>
<span class="normal"> 33</span>
<span class="normal"> 34</span>
<span class="normal"> 35</span>
<span class="normal"> 36</span>
<span class="normal"> 37</span>
<span class="normal"> 38</span>
<span class="normal"> 39</span>
<span class="normal"> 40</span>
<span class="normal"> 41</span>
<span class="normal"> 42</span>
<span class="normal"> 43</span>
<span class="normal"> 44</span>
<span class="normal"> 45</span>
<span class="normal"> 46</span>
<span class="normal"> 47</span>
<span class="normal"> 48</span>
<span class="normal"> 49</span>
<span class="normal"> 50</span>
<span class="normal"> 51</span>
<span class="normal"> 52</span>
<span class="normal"> 53</span>
<span class="normal"> 54</span>
<span class="normal"> 55</span>
<span class="normal"> 56</span>
<span class="normal"> 57</span>
<span class="normal"> 58</span>
<span class="normal"> 59</span>
<span class="normal"> 60</span>
<span class="normal"> 61</span>
<span class="normal"> 62</span>
<span class="normal"> 63</span>
<span class="normal"> 64</span>
<span class="normal"> 65</span>
<span class="normal"> 66</span>
<span class="normal"> 67</span>
<span class="normal"> 68</span>
<span class="normal"> 69</span>
<span class="normal"> 70</span>
<span class="normal"> 71</span>
<span class="normal"> 72</span>
<span class="normal"> 73</span>
<span class="normal"> 74</span>
<span class="normal"> 75</span>
<span class="normal"> 76</span>
<span class="normal"> 77</span>
<span class="normal"> 78</span>
<span class="normal"> 79</span>
<span class="normal"> 80</span>
<span class="normal"> 81</span>
<span class="normal"> 82</span>
<span class="normal"> 83</span>
<span class="normal"> 84</span>
<span class="normal"> 85</span>
<span class="normal"> 86</span>
<span class="normal"> 87</span>
<span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">Aprofs</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Aprofs Class</span>

<span class="sd">    A class for analyzing SHAP values using approximate predictions.</span>
<span class="sd">    --------------------------------------------------------------</span>


<span class="sd">    Attributes:</span>
<span class="sd">        current_data (pd.DataFrame): The current data.</span>
<span class="sd">        target_column (Series): The target column.</span>
<span class="sd">        link (function): The link function.</span>
<span class="sd">        link_srt (str): The string representation of the link function.</span>
<span class="sd">        shap_mean (float): The mean SHAP value. None if SHAP values have not been calculated.</span>
<span class="sd">        shap_values (DataFrame): The SHAP values. None if SHAP values have not been calculated.</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">current_data</span><span class="p">,</span> <span class="n">target_column</span><span class="p">,</span> <span class="n">link_model</span><span class="p">:</span> <span class="n">LinkModels</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">current_data</span> <span class="o">=</span> <span class="n">current_data</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span> <span class="o">=</span> <span class="n">target_column</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span> <span class="o">=</span> <span class="n">ClassificationLogisticLink</span><span class="p">()</span> <span class="k">if</span> <span class="n">link_model</span> <span class="ow">is</span> <span class="kc">None</span> <span class="k">else</span> <span class="n">link_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span> <span class="o">=</span> <span class="kc">None</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="p">(</span>
            <span class="sa">f</span><span class="s2">&quot;Aprofs(current_data shape =</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">, target_column =</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="si">}</span><span class="s2">&quot;</span>
            <span class="o">+</span> <span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;, shap_mean=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="si">}</span><span class="s2">, shap_values.shape=</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">shape</span><span class="si">}</span><span class="s2">&quot;</span>
                <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span>
                <span class="k">else</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">  Shapley values have not been calculated!&quot;</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">calculate_shaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">type_model</span><span class="o">=</span><span class="s2">&quot;tree&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the SHAP values for the given model.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            model (Any): The trained model for which to calculate the SHAP values.</span>
<span class="sd">            type_model (str): type of model: tree based or other. If &quot;tree&quot; then TreeExplainer will be use, otherwise a general explainer from the SHAP package is used. Defaults to &#39;tree&#39;.</span>


<span class="sd">        Returns:</span>
<span class="sd">            None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">shap_values</span><span class="p">,</span> <span class="n">shap_mean</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_shap_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">type_model</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">=</span> <span class="n">shap_mean</span>

    <span class="k">def</span> <span class="nf">get_feature_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the performance of the features based on the SHAP values.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            features (List[str]): The list of features for which to calculate the performance.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The performance of the features based on the SHAP values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="o">.</span><span class="n">performance_fit</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">calculate_row_sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="p">)</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">brute_force_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform brute force feature selection by evaluating the performance of all possible combinations of features.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            features (List[str]): The list of features to consider for feature selection.</span>

<span class="sd">        Returns:</span>
<span class="sd">            List[str]: The best list of features with the highest performance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">best_performance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="n">best_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">all_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">generate_all_combinations</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>
        <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">)</span><span class="si">}</span><span class="s2"> combinations&quot;</span><span class="p">):</span>
            <span class="n">current_performance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_performance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">comb</span><span class="p">))</span>
            <span class="k">if</span> <span class="n">current_performance</span> <span class="o">&gt;</span> <span class="n">best_performance</span><span class="p">:</span>
                <span class="n">best_performance</span> <span class="o">=</span> <span class="n">current_performance</span>
                <span class="n">best_list</span> <span class="o">=</span> <span class="n">comb</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the best list is </span><span class="si">{</span><span class="n">best_list</span><span class="si">}</span><span class="s2"> with performance </span><span class="si">{</span><span class="n">best_performance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_list</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">gready_forward_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">greediness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Perform gready forward feature selection by evaluating the performance of all possible combinations of features.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            features (List[str]): The list of features to consider for feature selection.</span>
<span class="sd">            greediness (float): The greediness factor, how much better needs to be the performance to add the feature. Default is 0.001.</span>
<span class="sd">        Returns:</span>
<span class="sd">            List[str]: The best list of features with the highest performance.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">best_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">candidate_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
        <span class="n">aproximate_performance</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">best_performance</span> <span class="o">=</span> <span class="mf">0.0</span>
        <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">best_feature_</span><span class="p">,</span> <span class="n">best_performance_</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">best_feature</span><span class="p">(</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span> <span class="n">best_list</span><span class="p">,</span> <span class="n">candidate_list</span>
            <span class="p">)</span>
            <span class="n">candidate_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">best_feature_</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="o">.</span><span class="n">perform</span> <span class="o">==</span> <span class="s2">&quot;maximize&quot;</span><span class="p">:</span>  <span class="c1"># maximize metric</span>
                <span class="k">if</span> <span class="n">best_performance</span> <span class="o">&gt;</span> <span class="n">best_performance_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">greediness</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The feature </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> wont be added&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">best_performance</span> <span class="o">=</span> <span class="n">best_performance_</span>
                    <span class="n">best_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_feature_</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the best feature to add is </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> with performance </span><span class="si">{</span><span class="n">best_performance_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">aproximate_performance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_performance_</span><span class="p">)</span>

            <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="o">.</span><span class="n">perform</span> <span class="o">==</span> <span class="s2">&quot;minimize&quot;</span><span class="p">:</span>  <span class="c1"># minimize metric</span>
                <span class="k">if</span> <span class="n">best_performance</span> <span class="o">&lt;</span> <span class="n">best_performance_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">greediness</span><span class="p">):</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The feature </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> wont be added&quot;</span><span class="p">)</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">best_performance</span> <span class="o">=</span> <span class="n">best_performance_</span>
                    <span class="n">best_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_feature_</span><span class="p">)</span>
                    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the best feature to add is </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> with performance </span><span class="si">{</span><span class="n">best_performance_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                    <span class="n">aproximate_performance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_performance_</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">best_list</span>

    <span class="k">def</span> <span class="nf">get_shap_p_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">suffle_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the p-values of the SHAP values of the features.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            features (List[str]): The list of features for which to calculate the p-values.</span>
<span class="sd">            suffle_size (int): The number of shuffling iterations to perform. Default is 500.</span>

<span class="sd">        Returns:</span>
<span class="sd">            pd.DataFrame: A DataFrame containing the features and their corresponding p-values.</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">p_values</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">performance_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_performance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
            <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
                <span class="n">utils</span><span class="o">.</span><span class="n">random_sort_shaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">suffle_size</span><span class="p">)</span>
            <span class="p">]</span>
            <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sample</span> <span class="o">&gt;</span> <span class="n">performance_threshold</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">)</span>
            <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">suffle_size</span><span class="p">)</span>

        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Feature&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;p-value_shap&quot;</span><span class="p">:</span> <span class="n">p_values</span><span class="p">})</span>

    <span class="k">def</span> <span class="nf">visualize_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">main_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">other_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
        <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize the marginal effect of a feature on the target variable.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            main_feature (str): The main feature for which to visualize the marginal effect.</span>
<span class="sd">            other_features (List[str]): The list of other features to include in the visualization. Default is None.</span>
<span class="sd">            nbins (int): The number of bins to use for the visualization. Default is 20.</span>
<span class="sd">            type_bins (str): The type of binning to use. Default is &quot;qcut&quot;.</span>
<span class="sd">            type_plot (str): The type of plot to generate. Default is &quot;prob&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate data to plot marginal effect shapley values</span>
        <span class="k">if</span> <span class="n">other_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">other_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_feature</span><span class="p">)</span>
        <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other_features</span><span class="p">)</span>

        <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">temp_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
        <span class="c1"># call plotting function</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span>
            <span class="n">temp_data</span><span class="p">,</span>
            <span class="n">main_feature</span><span class="p">,</span>
            <span class="n">other_features</span><span class="o">=</span><span class="n">other_features</span><span class="p">,</span>
            <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
            <span class="n">type_bins</span><span class="o">=</span><span class="n">type_bins</span><span class="p">,</span>
            <span class="n">type_plot</span><span class="o">=</span><span class="n">type_plot</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">compare_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">other</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
        <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize the marginal effect of a feature on the target variable.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            feature (str): The main feature for which to visualize the marginal effect.</span>
<span class="sd">            nbins (int): The number of bins to use for the visualization. Default is 20.</span>
<span class="sd">            type_bins (str): The type of binning to use. Default is &quot;qcut&quot;.</span>
<span class="sd">            type_plot (str): The type of plot to generate. Default is &quot;prob&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Aprofs</span><span class="p">):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only compare with another Aprofs object&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following feature are missing in the SHAP values: </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">temp_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_plot_compare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
        <span class="c1"># call plotting function</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">plot_data_compare</span><span class="p">(</span>
            <span class="n">temp_data</span><span class="p">,</span>
            <span class="n">feature</span><span class="p">,</span>
            <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
            <span class="n">type_bins</span><span class="o">=</span><span class="n">type_bins</span><span class="p">,</span>
            <span class="n">type_plot</span><span class="o">=</span><span class="n">type_plot</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">def</span> <span class="nf">visualize_neutralized_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">main_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
        <span class="n">neutralize_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
        <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
        <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
        <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Visualize the marginal effect of a feature on the target variable after neutralizing the effect of other features.</span>

<span class="sd">        Parameters:</span>
<span class="sd">            main_feature (str): The main feature for which to visualize the marginal effect.</span>
<span class="sd">            neutralize_features (List[str]): The list of other features to be neutralized.</span>
<span class="sd">            nbins (int): The number of bins to use for the visualization. Default is 20.</span>
<span class="sd">            type_bins (str): The type of binning to use. Default is &quot;qcut&quot;.</span>
<span class="sd">            type_plot (str): The type of plot to generate. Default is &quot;prob&quot;.</span>

<span class="sd">        Returns:</span>
<span class="sd">            None</span>

<span class="sd">        Raises:</span>
<span class="sd">            ValueError: If an any feature is missing in the SHAP values dataframe.</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="c1"># generate data to plot marginal effect shapley values</span>
        <span class="k">if</span> <span class="n">neutralize_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="n">neutralize_features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">neutralize_features</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
            <span class="n">neutralize_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">neutralize_features</span><span class="p">]</span>

        <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_feature</span><span class="p">)</span>
        <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">neutralize_features</span><span class="p">)</span>
        <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>  <span class="c1"># remove duplicates</span>

        <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

        <span class="n">temp_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_neutral_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neutralize_features</span><span class="p">)</span>
        <span class="n">temp_data</span><span class="p">[</span><span class="n">main_feature</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="p">[</span><span class="n">main_feature</span><span class="p">]</span>
        <span class="c1"># call plotting function</span>
        <span class="n">utils</span><span class="o">.</span><span class="n">plot_data_neutral</span><span class="p">(</span>
            <span class="n">temp_data</span><span class="p">,</span>
            <span class="n">main_feature</span><span class="p">,</span>
            <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
            <span class="n">type_bins</span><span class="o">=</span><span class="n">type_bins</span><span class="p">,</span>
            <span class="n">type_plot</span><span class="o">=</span><span class="n">type_plot</span><span class="p">,</span>
        <span class="p">)</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.brute_force_selection" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">brute_force_selection</span><span class="p">(</span><span class="n">features</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform brute force feature selection by evaluating the performance of all possible combinations of features.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of features to consider for feature selection.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[str]: The best list of features with the highest performance.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">brute_force_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform brute force feature selection by evaluating the performance of all possible combinations of features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        features (List[str]): The list of features to consider for feature selection.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The best list of features with the highest performance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">best_performance</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="n">best_list</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">all_combinations</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">utils</span><span class="o">.</span><span class="n">generate_all_combinations</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">comb</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">,</span> <span class="n">desc</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;Processing </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">all_combinations</span><span class="p">)</span><span class="si">}</span><span class="s2"> combinations&quot;</span><span class="p">):</span>
        <span class="n">current_performance</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_performance</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">comb</span><span class="p">))</span>
        <span class="k">if</span> <span class="n">current_performance</span> <span class="o">&gt;</span> <span class="n">best_performance</span><span class="p">:</span>
            <span class="n">best_performance</span> <span class="o">=</span> <span class="n">current_performance</span>
            <span class="n">best_list</span> <span class="o">=</span> <span class="n">comb</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the best list is </span><span class="si">{</span><span class="n">best_list</span><span class="si">}</span><span class="s2"> with performance </span><span class="si">{</span><span class="n">best_performance</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">list</span><span class="p">(</span><span class="n">best_list</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.calculate_shaps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_shaps</span><span class="p">(</span><span class="n">model</span><span class="p">,</span> <span class="n">type_model</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the SHAP values for the given model.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Any">Any</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The trained model for which to calculate the SHAP values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>type of model: tree based or other. If "tree" then TreeExplainer will be use, otherwise a general explainer from the SHAP package is used. Defaults to 'tree'.</p>
            </div>
          </td>
          <td>
                <code>&#39;tree&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span>
<span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_shaps</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Any</span><span class="p">,</span> <span class="n">type_model</span><span class="o">=</span><span class="s2">&quot;tree&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the SHAP values for the given model.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        model (Any): The trained model for which to calculate the SHAP values.</span>
<span class="sd">        type_model (str): type of model: tree based or other. If &quot;tree&quot; then TreeExplainer will be use, otherwise a general explainer from the SHAP package is used. Defaults to &#39;tree&#39;.</span>


<span class="sd">    Returns:</span>
<span class="sd">        None</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shap_values</span><span class="p">,</span> <span class="n">shap_mean</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">get_shap_values</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">type_model</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">index</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="o">.</span><span class="n">index</span><span class="p">,</span> <span class="n">columns</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">=</span> <span class="n">shap_mean</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.compare_feature" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">compare_feature</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s1">&#39;qcut&#39;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Visualize the marginal effect of a feature on the target variable.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The main feature for which to visualize the marginal effect.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>nbins</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins to use for the visualization. Default is 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_bins</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of binning to use. Default is "qcut".</p>
            </div>
          </td>
          <td>
                <code>&#39;qcut&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_plot</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plot to generate. Default is "prob".</p>
            </div>
          </td>
          <td>
                <code>&#39;prob&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">250</span>
<span class="normal">251</span>
<span class="normal">252</span>
<span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">compare_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">other</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
    <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the marginal effect of a feature on the target variable.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        feature (str): The main feature for which to visualize the marginal effect.</span>
<span class="sd">        nbins (int): The number of bins to use for the visualization. Default is 20.</span>
<span class="sd">        type_bins (str): The type of binning to use. Default is &quot;qcut&quot;.</span>
<span class="sd">        type_plot (str): The type of plot to generate. Default is &quot;prob&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other</span><span class="p">,</span> <span class="n">Aprofs</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Can only compare with another Aprofs object&quot;</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following feature are missing in the SHAP values: </span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">temp_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_plot_compare_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
    <span class="c1"># call plotting function</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">plot_data_compare</span><span class="p">(</span>
        <span class="n">temp_data</span><span class="p">,</span>
        <span class="n">feature</span><span class="p">,</span>
        <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
        <span class="n">type_bins</span><span class="o">=</span><span class="n">type_bins</span><span class="p">,</span>
        <span class="n">type_plot</span><span class="o">=</span><span class="n">type_plot</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.get_feature_performance" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_feature_performance</span><span class="p">(</span><span class="n">features</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the performance of the features based on the SHAP values.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of features for which to calculate the performance.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The performance of the features based on the SHAP values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_feature_performance</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the performance of the features based on the SHAP values.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        features (List[str]): The list of features for which to calculate the performance.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The performance of the features based on the SHAP values.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="o">.</span><span class="n">performance_fit</span><span class="p">(</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span> <span class="n">utils</span><span class="o">.</span><span class="n">calculate_row_sum</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">,</span> <span class="n">features</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="p">)</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.get_shap_p_value" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_shap_p_value</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">suffle_size</span><span class="o">=</span><span class="mi">500</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the p-values of the SHAP values of the features.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of features for which to calculate the p-values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>suffle_size</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of shuffling iterations to perform. Default is 500.</p>
            </div>
          </td>
          <td>
                <code>500</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: A DataFrame containing the features and their corresponding p-values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span>
<span class="normal">178</span>
<span class="normal">179</span>
<span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span>
<span class="normal">195</span>
<span class="normal">196</span>
<span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_shap_p_value</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">suffle_size</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">500</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the p-values of the SHAP values of the features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        features (List[str]): The list of features for which to calculate the p-values.</span>
<span class="sd">        suffle_size (int): The number of shuffling iterations to perform. Default is 500.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: A DataFrame containing the features and their corresponding p-values.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">p_values</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">performance_threshold</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_feature_performance</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">tqdm</span><span class="p">(</span><span class="n">features</span><span class="p">):</span>
        <span class="n">samples</span> <span class="o">=</span> <span class="p">[</span>
            <span class="n">utils</span><span class="o">.</span><span class="n">random_sort_shaps</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">suffle_size</span><span class="p">)</span>
        <span class="p">]</span>
        <span class="n">count</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span><span class="n">sample</span> <span class="o">&gt;</span> <span class="n">performance_threshold</span> <span class="k">for</span> <span class="n">sample</span> <span class="ow">in</span> <span class="n">samples</span><span class="p">)</span>
        <span class="n">p_values</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">count</span> <span class="o">/</span> <span class="n">suffle_size</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s2">&quot;Feature&quot;</span><span class="p">:</span> <span class="n">features</span><span class="p">,</span> <span class="s2">&quot;p-value_shap&quot;</span><span class="p">:</span> <span class="n">p_values</span><span class="p">})</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.gready_forward_selection" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">gready_forward_selection</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">greediness</span><span class="o">=</span><span class="mf">0.001</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Perform gready forward feature selection by evaluating the performance of all possible combinations of features.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of features to consider for feature selection.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>greediness</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The greediness factor, how much better needs to be the performance to add the feature. Default is 0.001.</p>
            </div>
          </td>
          <td>
                <code>0.001</code>
          </td>
        </tr>
    </tbody>
  </table>
      <p>Returns:
    List[str]: The best list of features with the highest performance.</p>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">gready_forward_selection</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">greediness</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mf">0.001</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Perform gready forward feature selection by evaluating the performance of all possible combinations of features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        features (List[str]): The list of features to consider for feature selection.</span>
<span class="sd">        greediness (float): The greediness factor, how much better needs to be the performance to add the feature. Default is 0.001.</span>
<span class="sd">    Returns:</span>
<span class="sd">        List[str]: The best list of features with the highest performance.</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">best_list</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">candidate_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="n">features</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">aproximate_performance</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">float</span><span class="p">]</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">best_performance</span> <span class="o">=</span> <span class="mf">0.0</span>
    <span class="k">while</span> <span class="nb">len</span><span class="p">(</span><span class="n">candidate_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">best_feature_</span><span class="p">,</span> <span class="n">best_performance_</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">best_feature</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_mean</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span> <span class="n">best_list</span><span class="p">,</span> <span class="n">candidate_list</span>
        <span class="p">)</span>
        <span class="n">candidate_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">best_feature_</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="o">.</span><span class="n">perform</span> <span class="o">==</span> <span class="s2">&quot;maximize&quot;</span><span class="p">:</span>  <span class="c1"># maximize metric</span>
            <span class="k">if</span> <span class="n">best_performance</span> <span class="o">&gt;</span> <span class="n">best_performance_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">greediness</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The feature </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> wont be added&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">best_performance</span> <span class="o">=</span> <span class="n">best_performance_</span>
                <span class="n">best_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_feature_</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the best feature to add is </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> with performance </span><span class="si">{</span><span class="n">best_performance_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">aproximate_performance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_performance_</span><span class="p">)</span>

        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">link_model</span><span class="o">.</span><span class="n">perform</span> <span class="o">==</span> <span class="s2">&quot;minimize&quot;</span><span class="p">:</span>  <span class="c1"># minimize metric</span>
            <span class="k">if</span> <span class="n">best_performance</span> <span class="o">&lt;</span> <span class="n">best_performance_</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">greediness</span><span class="p">):</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The feature </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> wont be added&quot;</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">best_performance</span> <span class="o">=</span> <span class="n">best_performance_</span>
                <span class="n">best_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_feature_</span><span class="p">)</span>
                <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;the best feature to add is </span><span class="si">{</span><span class="n">best_feature_</span><span class="si">}</span><span class="s2"> with performance </span><span class="si">{</span><span class="n">best_performance_</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
                <span class="n">aproximate_performance</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">best_performance_</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">best_list</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.visualize_feature" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">visualize_feature</span><span class="p">(</span><span class="n">main_feature</span><span class="p">,</span> <span class="n">other_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s1">&#39;qcut&#39;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Visualize the marginal effect of a feature on the target variable.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>main_feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The main feature for which to visualize the marginal effect.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>other_features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of other features to include in the visualization. Default is None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>nbins</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins to use for the visualization. Default is 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_bins</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of binning to use. Default is "qcut".</p>
            </div>
          </td>
          <td>
                <code>&#39;qcut&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_plot</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plot to generate. Default is "prob".</p>
            </div>
          </td>
          <td>
                <code>&#39;prob&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values dataframe.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">main_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">other_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
    <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the marginal effect of a feature on the target variable.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        main_feature (str): The main feature for which to visualize the marginal effect.</span>
<span class="sd">        other_features (List[str]): The list of other features to include in the visualization. Default is None.</span>
<span class="sd">        nbins (int): The number of bins to use for the visualization. Default is 20.</span>
<span class="sd">        type_bins (str): The type of binning to use. Default is &quot;qcut&quot;.</span>
<span class="sd">        type_plot (str): The type of plot to generate. Default is &quot;prob&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># generate data to plot marginal effect shapley values</span>
    <span class="k">if</span> <span class="n">other_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_feature</span><span class="p">)</span>
    <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other_features</span><span class="p">)</span>

    <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">temp_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
    <span class="c1"># call plotting function</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">plot_data</span><span class="p">(</span>
        <span class="n">temp_data</span><span class="p">,</span>
        <span class="n">main_feature</span><span class="p">,</span>
        <span class="n">other_features</span><span class="o">=</span><span class="n">other_features</span><span class="p">,</span>
        <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
        <span class="n">type_bins</span><span class="o">=</span><span class="n">type_bins</span><span class="p">,</span>
        <span class="n">type_plot</span><span class="o">=</span><span class="n">type_plot</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.code.Aprofs.visualize_neutralized_feature" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">visualize_neutralized_feature</span><span class="p">(</span><span class="n">main_feature</span><span class="p">,</span> <span class="n">neutralize_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s1">&#39;qcut&#39;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span></code>

</h3>


  <div class="doc doc-contents ">
  
      <p>Visualize the marginal effect of a feature on the target variable after neutralizing the effect of other features.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>main_feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The main feature for which to visualize the marginal effect.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>neutralize_features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of other features to be neutralized.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>nbins</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins to use for the visualization. Default is 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_bins</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of binning to use. Default is "qcut".</p>
            </div>
          </td>
          <td>
                <code>&#39;qcut&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_plot</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plot to generate. Default is "prob".</p>
            </div>
          </td>
          <td>
                <code>&#39;prob&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If an any feature is missing in the SHAP values dataframe.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/code.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span>
<span class="normal">320</span>
<span class="normal">321</span>
<span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">visualize_neutralized_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="bp">self</span><span class="p">,</span>
    <span class="n">main_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">neutralize_features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
    <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Visualize the marginal effect of a feature on the target variable after neutralizing the effect of other features.</span>

<span class="sd">    Parameters:</span>
<span class="sd">        main_feature (str): The main feature for which to visualize the marginal effect.</span>
<span class="sd">        neutralize_features (List[str]): The list of other features to be neutralized.</span>
<span class="sd">        nbins (int): The number of bins to use for the visualization. Default is 20.</span>
<span class="sd">        type_bins (str): The type of binning to use. Default is &quot;qcut&quot;.</span>
<span class="sd">        type_plot (str): The type of plot to generate. Default is &quot;prob&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If an any feature is missing in the SHAP values dataframe.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># generate data to plot marginal effect shapley values</span>
    <span class="k">if</span> <span class="n">neutralize_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">neutralize_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">neutralize_features</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">neutralize_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">neutralize_features</span><span class="p">]</span>

    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_feature</span><span class="p">)</span>
    <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">neutralize_features</span><span class="p">)</span>
    <span class="n">features</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">features</span><span class="p">))</span>  <span class="c1"># remove duplicates</span>

    <span class="n">missing_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">feature</span> <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span> <span class="k">if</span> <span class="n">feature</span> <span class="ow">not</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">missing_features</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;The following features are missing in the SHAP values: </span><span class="si">{</span><span class="n">missing_features</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>

    <span class="n">temp_data</span> <span class="o">=</span> <span class="n">utils</span><span class="o">.</span><span class="n">temp_neutral_plot_data</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">neutralize_features</span><span class="p">)</span>
    <span class="n">temp_data</span><span class="p">[</span><span class="n">main_feature</span><span class="p">]</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">current_data</span><span class="p">[</span><span class="n">main_feature</span><span class="p">]</span>
    <span class="c1"># call plotting function</span>
    <span class="n">utils</span><span class="o">.</span><span class="n">plot_data_neutral</span><span class="p">(</span>
        <span class="n">temp_data</span><span class="p">,</span>
        <span class="n">main_feature</span><span class="p">,</span>
        <span class="n">nbins</span><span class="o">=</span><span class="n">nbins</span><span class="p">,</span>
        <span class="n">type_bins</span><span class="o">=</span><span class="n">type_bins</span><span class="p">,</span>
        <span class="n">type_plot</span><span class="o">=</span><span class="n">type_plot</span><span class="p">,</span>
    <span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>




  </div>

  </div>

</div><h2 id="detailed-api-models">Detailed API <strong>models</strong></h2>


<div class="doc doc-object doc-module">



<a id="src.aprofs.models"></a>
  <div class="doc doc-contents first">
  
      <p>This module implements the models class.
this wasy we can extend this class to implement new models
to calculate the use with the aprofs class</p>

  

  <div class="doc doc-children">








<div class="doc doc-object doc-class">



<h2 id="src.aprofs.models.ClassificationLogisticLink" class="doc doc-heading">
          <code>ClassificationLogisticLink</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.aprofs.models.LinkModels" href="#src.aprofs.models.LinkModels">LinkModels</a></code></p>

  
      <p>This class implements the interface for classification with logistic link</p>

            <details class="quote">
              <summary>Source code in <code>src/aprofs/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span>
<span class="normal">128</span>
<span class="normal">129</span>
<span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">ClassificationLogisticLink</span><span class="p">(</span><span class="n">LinkModels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements the interface for classification with logistic link&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">type_model</span><span class="o">=</span><span class="s2">&quot;classification&quot;</span><span class="p">,</span> <span class="n">type_link</span><span class="o">=</span><span class="s2">&quot;logistic&quot;</span><span class="p">,</span> <span class="n">perform</span><span class="o">=</span><span class="s2">&quot;maximize&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">performance_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inv_prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inv_prediction</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input type for link_calculate&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">inv_prediction</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">inv_link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">prediction</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">-</span> <span class="n">prediction</span><span class="p">))</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">() with type model </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_model</span><span class="si">}</span><span class="s2"> and type link </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_link</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="src.aprofs.models.LinkModels" class="doc doc-heading">
          <code>LinkModels</code>


</h2>


  <div class="doc doc-contents ">

  
      <p>This class implements the interface for the link models
to be used in the aprofs class</p>

<details class="functionality-that-needs-ot-be-implemented" open>
  <summary>Functionality that needs ot be implemented</summary>
  <ul>
<li>performance_fit: calculate the performance of the model</li>
<li>link_calculate: calculate the link function</li>
<li>inv_link_calculate: calculate the inverse link function</li>
</ul>
</details>
            <details class="quote">
              <summary>Source code in <code>src/aprofs/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">17</span>
<span class="normal">18</span>
<span class="normal">19</span>
<span class="normal">20</span>
<span class="normal">21</span>
<span class="normal">22</span>
<span class="normal">23</span>
<span class="normal">24</span>
<span class="normal">25</span>
<span class="normal">26</span>
<span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">LinkModels</span><span class="p">(</span><span class="n">metaclass</span><span class="o">=</span><span class="n">abc</span><span class="o">.</span><span class="n">ABCMeta</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements the interface for the link models</span>
<span class="sd">    to be used in the aprofs class</span>

<span class="sd">    Functionality that needs ot be implemented:</span>
<span class="sd">        - performance_fit: calculate the performance of the model</span>
<span class="sd">        - link_calculate: calculate the link function</span>
<span class="sd">        - inv_link_calculate: calculate the inverse link function</span>

<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">type_model</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">type_link</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span> <span class="n">perform</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_model</span> <span class="o">=</span> <span class="n">type_model</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">type_link</span> <span class="o">=</span> <span class="n">type_link</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">perform</span> <span class="o">=</span> <span class="n">perform</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">performance_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the performance of the model.</span>

<span class="sd">        Args:</span>
<span class="sd">            target (np.ndarray): The true target values.</span>
<span class="sd">            prediction (np.ndarray): The predicted values.</span>

<span class="sd">        Returns:</span>
<span class="sd">            float: The performance metric.</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inv_prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the link function.</span>

<span class="sd">        Args:</span>
<span class="sd">            inv_prediction (Union[int, float, np.ndarray]): The input value(s).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[int, float, np.ndarray]: The transformed value(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
    <span class="k">def</span> <span class="nf">inv_link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">        </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Calculate the inverse link function.</span>

<span class="sd">        Args:</span>
<span class="sd">            prediction (Union[int, float, np.ndarray]): The input value(s).</span>

<span class="sd">        Returns:</span>
<span class="sd">            Union[int, float, np.ndarray]: The transformed value(s).</span>
<span class="sd">        &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h3 id="src.aprofs.models.LinkModels.inv_link_calculate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">inv_link_calculate</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the inverse link function.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>prediction</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, float, <span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input value(s).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="typing.Union">Union</span>[int, float, <span title="numpy.ndarray">ndarray</span>, <span title="pandas.Series">Series</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[int, float, np.ndarray]: The transformed value(s).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/models.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span> <span class="nf">inv_link_calculate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the inverse link function.</span>

<span class="sd">    Args:</span>
<span class="sd">        prediction (Union[int, float, np.ndarray]): The input value(s).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[int, float, np.ndarray]: The transformed value(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.models.LinkModels.link_calculate" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">link_calculate</span><span class="p">(</span><span class="n">inv_prediction</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the link function.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>inv_prediction</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[int, float, <span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input value(s).</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="typing.Union">Union</span>[int, float, <span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[int, float, np.ndarray]: The transformed value(s).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/models.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span>
<span class="normal">52</span>
<span class="normal">53</span>
<span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span> <span class="nf">link_calculate</span><span class="p">(</span>
    <span class="bp">self</span><span class="p">,</span> <span class="n">inv_prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the link function.</span>

<span class="sd">    Args:</span>
<span class="sd">        inv_prediction (Union[int, float, np.ndarray]): The input value(s).</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[int, float, np.ndarray]: The transformed value(s).</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h3 id="src.aprofs.models.LinkModels.performance_fit" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">performance_fit</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prediction</span><span class="p">)</span></code>
  
  <span class="doc doc-labels">
      <small class="doc doc-label doc-label-abstractmethod"><code>abstractmethod</code></small>
  </span>

</h3>


  <div class="doc doc-contents ">
  
      <p>Calculate the performance of the model.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>target</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The true target values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>prediction</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The predicted values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The performance metric.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/models.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="nd">@abc</span><span class="o">.</span><span class="n">abstractmethod</span>
<span class="k">def</span> <span class="nf">performance_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculate the performance of the model.</span>

<span class="sd">    Args:</span>
<span class="sd">        target (np.ndarray): The true target values.</span>
<span class="sd">        prediction (np.ndarray): The predicted values.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The performance metric.</span>
<span class="sd">    &quot;&quot;&quot;</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="src.aprofs.models.RegressionIdentityLink" class="doc doc-heading">
          <code>RegressionIdentityLink</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.aprofs.models.LinkModels" href="#src.aprofs.models.LinkModels">LinkModels</a></code></p>

  
      <p>This class implements the interface for regression with identity link</p>

            <details class="quote">
              <summary>Source code in <code>src/aprofs/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegressionIdentityLink</span><span class="p">(</span><span class="n">LinkModels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements the interface for regression with identity link&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">type_model</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">type_link</span><span class="o">=</span><span class="s2">&quot;identity&quot;</span><span class="p">,</span> <span class="n">perform</span><span class="o">=</span><span class="s2">&quot;minimize&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">performance_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prediction</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inv_prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">inv_prediction</span>

    <span class="k">def</span> <span class="nf">inv_link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">prediction</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">() with type model </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_model</span><span class="si">}</span><span class="s2"> and type link </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_link</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>

<div class="doc doc-object doc-class">



<h2 id="src.aprofs.models.RegressionLogLink" class="doc doc-heading">
          <code>RegressionLogLink</code>


</h2>


  <div class="doc doc-contents ">
          <p class="doc doc-class-bases">
            Bases: <code><a class="autorefs autorefs-internal" title="src.aprofs.models.LinkModels" href="#src.aprofs.models.LinkModels">LinkModels</a></code></p>

  
      <p>This class implements the interface for regression with logarithmic link</p>

            <details class="quote">
              <summary>Source code in <code>src/aprofs/models.py</code></summary>
              <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">75</span>
<span class="normal">76</span>
<span class="normal">77</span>
<span class="normal">78</span>
<span class="normal">79</span>
<span class="normal">80</span>
<span class="normal">81</span>
<span class="normal">82</span>
<span class="normal">83</span>
<span class="normal">84</span>
<span class="normal">85</span>
<span class="normal">86</span>
<span class="normal">87</span>
<span class="normal">88</span>
<span class="normal">89</span>
<span class="normal">90</span>
<span class="normal">91</span>
<span class="normal">92</span>
<span class="normal">93</span>
<span class="normal">94</span>
<span class="normal">95</span>
<span class="normal">96</span>
<span class="normal">97</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">class</span> <span class="nc">RegressionLogLink</span><span class="p">(</span><span class="n">LinkModels</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;This class implements the interface for regression with logarithmic link&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
        <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="n">type_model</span><span class="o">=</span><span class="s2">&quot;regression&quot;</span><span class="p">,</span> <span class="n">type_link</span><span class="o">=</span><span class="s2">&quot;logarithmic&quot;</span><span class="p">,</span> <span class="n">perform</span><span class="o">=</span><span class="s2">&quot;minimize&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">performance_fit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">],</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">sqrt</span><span class="p">(</span><span class="n">mean_squared_error</span><span class="p">(</span><span class="n">target</span><span class="p">,</span> <span class="n">prediction</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">inv_prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">inv_prediction</span><span class="p">,</span> <span class="p">(</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">)):</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Invalid input type for link_calculate&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">inv_prediction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">inv_link_calculate</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span> <span class="n">prediction</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="n">prediction</span><span class="p">)</span>

    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span><span class="si">}</span><span class="s2">() with type model </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_model</span><span class="si">}</span><span class="s2"> and type link </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">type_link</span><span class="si">}</span><span class="s2">&quot;</span>
</code></pre></div></td></tr></table></div>
            </details>

  

  <div class="doc doc-children">











  </div>

  </div>


</div>




  </div>

  </div>

</div><h2 id="detailed-api-utilities">Detailed API <strong>utilities</strong></h2>


<div class="doc doc-object doc-module">



<a id="src.aprofs.utils"></a>
  <div class="doc doc-contents first">
  
      <p>Utility functions for the package.
this module contains utility functions that are used in the package.
the core functions are used to calculate the SHAP values and expected average SHAP value for a given dataset and model.</p>

  

  <div class="doc doc-children">










<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.best_feature" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">best_feature</span><span class="p">(</span><span class="n">shaps_values</span><span class="p">,</span> <span class="n">shap_expected_values</span><span class="p">,</span> <span class="n">link_model</span><span class="p">,</span> <span class="n">y_target</span><span class="p">,</span> <span class="n">current_list</span><span class="p">,</span> <span class="n">candidate_list</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Return the best feature to add to the current list based on the highest AUC score.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>shaps_values</code></td>
          <td>
                <code>DataFrame</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A DataFrame containing SHAP values for each feature.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>shap_expected_values</code></td>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A Series containing the expected SHAP values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>link_model</code></td>
          <td>
                <code>aprofs model object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An object that allows to calculate the performance of the model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>y_target</code></td>
          <td>
                <code>Series</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target variable for the AUC score calculation.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>current_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The current list of features.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>candidate_list</code></td>
          <td>
                <code>list</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of candidate features to consider adding.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>tuple</code></td>          <td>
                <code><span title="typing.Tuple">Tuple</span>[str, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple containing the best feature to add (str) and the corresponding best AUC score (float).</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Raises:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>ValueError</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>If <code>candidate_list</code> is empty.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal"> 88</span>
<span class="normal"> 89</span>
<span class="normal"> 90</span>
<span class="normal"> 91</span>
<span class="normal"> 92</span>
<span class="normal"> 93</span>
<span class="normal"> 94</span>
<span class="normal"> 95</span>
<span class="normal"> 96</span>
<span class="normal"> 97</span>
<span class="normal"> 98</span>
<span class="normal"> 99</span>
<span class="normal">100</span>
<span class="normal">101</span>
<span class="normal">102</span>
<span class="normal">103</span>
<span class="normal">104</span>
<span class="normal">105</span>
<span class="normal">106</span>
<span class="normal">107</span>
<span class="normal">108</span>
<span class="normal">109</span>
<span class="normal">110</span>
<span class="normal">111</span>
<span class="normal">112</span>
<span class="normal">113</span>
<span class="normal">114</span>
<span class="normal">115</span>
<span class="normal">116</span>
<span class="normal">117</span>
<span class="normal">118</span>
<span class="normal">119</span>
<span class="normal">120</span>
<span class="normal">121</span>
<span class="normal">122</span>
<span class="normal">123</span>
<span class="normal">124</span>
<span class="normal">125</span>
<span class="normal">126</span>
<span class="normal">127</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">best_feature</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="n">shaps_values</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">shap_expected_values</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">link_model</span><span class="p">:</span> <span class="n">LinkModels</span><span class="p">,</span>
    <span class="n">y_target</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span>
    <span class="n">current_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
    <span class="n">candidate_list</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Return the best feature to add to the current list based on the highest AUC score.</span>

<span class="sd">    Args:</span>
<span class="sd">        shaps_values (DataFrame): A DataFrame containing SHAP values for each feature.</span>
<span class="sd">        shap_expected_values (Series): A Series containing the expected SHAP values.</span>
<span class="sd">        link_model (aprofs model object): An object that allows to calculate the performance of the model.</span>
<span class="sd">        y_target (Series): The target variable for the AUC score calculation.</span>
<span class="sd">        current_list (list): The current list of features.</span>
<span class="sd">        candidate_list (list): The list of candidate features to consider adding.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the best feature to add (str) and the corresponding best AUC score (float).</span>

<span class="sd">    Raises:</span>
<span class="sd">        ValueError: If `candidate_list` is empty.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">candidate_list</span> <span class="o">==</span> <span class="p">[]</span> <span class="ow">or</span> <span class="n">candidate_list</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;The candidate list cannot be empty.&quot;</span><span class="p">)</span>

    <span class="n">best_feature</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="kc">None</span>
    <span class="n">best_auc</span><span class="p">:</span> <span class="nb">float</span> <span class="o">=</span> <span class="mi">0</span>
    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">candidate_list</span><span class="p">:</span>
        <span class="n">current_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
        <span class="n">aprox_preds</span> <span class="o">=</span> <span class="n">calculate_row_sum</span><span class="p">(</span><span class="n">shaps_values</span><span class="p">,</span> <span class="n">shap_expected_values</span><span class="p">,</span> <span class="n">current_list</span><span class="p">,</span> <span class="n">link_model</span><span class="p">)</span>
        <span class="n">auc</span> <span class="o">=</span> <span class="n">roc_auc_score</span><span class="p">(</span><span class="n">y_target</span><span class="p">,</span> <span class="n">aprox_preds</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">auc</span> <span class="o">&gt;</span> <span class="n">best_auc</span><span class="p">:</span>
            <span class="n">best_auc</span> <span class="o">=</span> <span class="n">auc</span>
            <span class="n">best_feature</span> <span class="o">=</span> <span class="n">feature</span>
        <span class="n">current_list</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">feature</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">best_feature</span><span class="p">,</span> <span class="n">best_auc</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.calculate_all_row_sum" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_all_row_sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">,</span> <span class="n">link_model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculates the row sum of <strong>all columns</strong> in a Shapley values DataFrame and applies a link function to the result.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>data</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input Shapley values DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>mean_value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mean shapley value to be added to the row sum.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>link_model</code></td>
          <td>
                <code>aprofs model object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An object that allows to calculate the performance of the model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="typing.Union">Union</span>[float, <span title="pandas.Series">Series</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[float, pd.Series]: The result of applying the link function to the row sum.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mean_value</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">link_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calculate_all_row_sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">,</span> <span class="n">link_function</span><span class="p">)</span>
<span class="go">225.0</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">54</span>
<span class="normal">55</span>
<span class="normal">56</span>
<span class="normal">57</span>
<span class="normal">58</span>
<span class="normal">59</span>
<span class="normal">60</span>
<span class="normal">61</span>
<span class="normal">62</span>
<span class="normal">63</span>
<span class="normal">64</span>
<span class="normal">65</span>
<span class="normal">66</span>
<span class="normal">67</span>
<span class="normal">68</span>
<span class="normal">69</span>
<span class="normal">70</span>
<span class="normal">71</span>
<span class="normal">72</span>
<span class="normal">73</span>
<span class="normal">74</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_all_row_sum</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">link_model</span><span class="p">:</span> <span class="n">LinkModels</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the row sum of **all columns** in a Shapley values DataFrame and applies a link function to the result.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): The input Shapley values DataFrame.</span>
<span class="sd">        mean_value (float): The mean shapley value to be added to the row sum.</span>
<span class="sd">        link_model (aprofs model object): An object that allows to calculate the performance of the model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[float, pd.Series]: The result of applying the link function to the row sum.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({&#39;A&#39;: [1, 2, 3], &#39;B&#39;: [4, 5, 6]})</span>
<span class="sd">        &gt;&gt;&gt; mean_value = 10.0</span>
<span class="sd">        &gt;&gt;&gt; link_function = lambda x: x ** 2</span>
<span class="sd">        &gt;&gt;&gt; calculate_all_row_sum(data, mean_value, link_function)</span>
<span class="sd">        225.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">link_model</span><span class="o">.</span><span class="n">link_calculate</span><span class="p">(</span><span class="n">mean_value</span> <span class="o">+</span> <span class="n">data</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.calculate_row_sum" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">calculate_row_sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">link_model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculates the row sum of specified columns in a Shapley values DataFrame and applies a link function to the result.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>data</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input DataFrame with shapley values.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>mean_value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mean shapley value to be added to the row sum.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>columns</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The list of column names to be summed.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>link_model</code></td>
          <td>
                <code>aprofs model object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An object that allows to calculate the performance of the model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="typing.Union">Union</span>[float, <span title="pandas.Series">Series</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Union[float, pd.Series]: The result of applying the link function to the row sum.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">({</span><span class="s1">&#39;A&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">1</span><span class="p">,</span> <span class="mi">2</span><span class="p">,</span> <span class="mi">3</span><span class="p">],</span> <span class="s1">&#39;B&#39;</span><span class="p">:</span> <span class="p">[</span><span class="mi">4</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">6</span><span class="p">]})</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">mean_value</span> <span class="o">=</span> <span class="mf">10.0</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">columns</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;A&#39;</span><span class="p">,</span> <span class="s1">&#39;B&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">link_function</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">**</span> <span class="mi">2</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">calculate_row_sum</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">,</span> <span class="n">columns</span><span class="p">,</span> <span class="n">link_function</span><span class="p">)</span>
<span class="go">225.0</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">27</span>
<span class="normal">28</span>
<span class="normal">29</span>
<span class="normal">30</span>
<span class="normal">31</span>
<span class="normal">32</span>
<span class="normal">33</span>
<span class="normal">34</span>
<span class="normal">35</span>
<span class="normal">36</span>
<span class="normal">37</span>
<span class="normal">38</span>
<span class="normal">39</span>
<span class="normal">40</span>
<span class="normal">41</span>
<span class="normal">42</span>
<span class="normal">43</span>
<span class="normal">44</span>
<span class="normal">45</span>
<span class="normal">46</span>
<span class="normal">47</span>
<span class="normal">48</span>
<span class="normal">49</span>
<span class="normal">50</span>
<span class="normal">51</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">calculate_row_sum</span><span class="p">(</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">mean_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span> <span class="n">columns</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">],</span> <span class="n">link_model</span><span class="p">:</span> <span class="n">LinkModels</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Union</span><span class="p">[</span><span class="nb">float</span><span class="p">,</span> <span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the row sum of specified columns in a Shapley values DataFrame and applies a link function to the result.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): The input DataFrame with shapley values.</span>
<span class="sd">        mean_value (float): The mean shapley value to be added to the row sum.</span>
<span class="sd">        columns (List[str]): The list of column names to be summed.</span>
<span class="sd">        link_model (aprofs model object): An object that allows to calculate the performance of the model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        Union[float, pd.Series]: The result of applying the link function to the row sum.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; data = pd.DataFrame({&#39;A&#39;: [1, 2, 3], &#39;B&#39;: [4, 5, 6]})</span>
<span class="sd">        &gt;&gt;&gt; mean_value = 10.0</span>
<span class="sd">        &gt;&gt;&gt; columns = [&#39;A&#39;, &#39;B&#39;]</span>
<span class="sd">        &gt;&gt;&gt; link_function = lambda x: x ** 2</span>
<span class="sd">        &gt;&gt;&gt; calculate_row_sum(data, mean_value, columns, link_function)</span>
<span class="sd">        225.0</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="n">link_model</span><span class="o">.</span><span class="n">link_calculate</span><span class="p">(</span><span class="n">mean_value</span> <span class="o">+</span> <span class="n">data</span><span class="p">[</span><span class="n">columns</span><span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">))</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.generate_all_combinations" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">generate_all_combinations</span><span class="p">(</span><span class="n">features</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generates all possible combinations of the given features list.
This will be used to test all possible combinations fo features to find the best combination.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of features.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="typing.List">List</span>[<span title="typing.Tuple">Tuple</span>[str]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>List[Tuple[str]]: A list of tuples representing all possible combinations of the features.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">180</span>
<span class="normal">181</span>
<span class="normal">182</span>
<span class="normal">183</span>
<span class="normal">184</span>
<span class="normal">185</span>
<span class="normal">186</span>
<span class="normal">187</span>
<span class="normal">188</span>
<span class="normal">189</span>
<span class="normal">190</span>
<span class="normal">191</span>
<span class="normal">192</span>
<span class="normal">193</span>
<span class="normal">194</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">generate_all_combinations</span><span class="p">(</span><span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">str</span><span class="p">]]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generates all possible combinations of the given features list.</span>
<span class="sd">    This will be used to test all possible combinations fo features to find the best combination.</span>

<span class="sd">    Args:</span>
<span class="sd">        features (List[str]): A list of features.</span>

<span class="sd">    Returns:</span>
<span class="sd">        List[Tuple[str]]: A list of tuples representing all possible combinations of the features.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">all_combinations</span><span class="p">:</span> <span class="n">List</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">feature_size</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">features</span><span class="p">)</span> <span class="o">+</span> <span class="mi">1</span><span class="p">):</span>
        <span class="n">all_combinations</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">combinations</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="n">feature_size</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">all_combinations</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.get_shap_values" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">get_shap_values</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">model</span><span class="p">,</span> <span class="n">type_model</span><span class="o">=</span><span class="s1">&#39;tree&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Calculates the SHAP values and expected average shap value for a given dataset and model.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>data</code></td>
          <td>
                <code><span title="numpy.ndarray">ndarray</span> or <span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The input dataset.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>model</code></td>
          <td>
                <code><span title="typing.Callable">Callable</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The trained model object.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_model</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>type of model: tree based or other. If "tree" then TreeExplainer will be use, otherwise a general explainer from the SHAP package is used. Defaults to 'tree'.</p>
            </div>
          </td>
          <td>
                <code>&#39;tree&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>tuple</code></td>          <td>
                <code><span title="typing.Tuple">Tuple</span>[<span title="pandas.DataFrame">DataFrame</span>, float]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A tuple containing the SHAP values and the Average shap value.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="c1"># Imports</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">xgboost</span> <span class="kn">import</span> <span class="n">XGBClassifier</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">load_iris</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Imports SHAP Package</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">shap</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Load the iris dataset</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">iris</span> <span class="o">=</span> <span class="n">load_iris</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">iris</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="n">iris</span><span class="o">.</span><span class="n">target</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Split the dataset into train and test sets</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Train a model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">XGBClassifier</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate SHAP values and expected value</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shap_values</span><span class="p">,</span> <span class="n">expected_value</span> <span class="o">=</span> <span class="n">get_shap_tree_values</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">130</span>
<span class="normal">131</span>
<span class="normal">132</span>
<span class="normal">133</span>
<span class="normal">134</span>
<span class="normal">135</span>
<span class="normal">136</span>
<span class="normal">137</span>
<span class="normal">138</span>
<span class="normal">139</span>
<span class="normal">140</span>
<span class="normal">141</span>
<span class="normal">142</span>
<span class="normal">143</span>
<span class="normal">144</span>
<span class="normal">145</span>
<span class="normal">146</span>
<span class="normal">147</span>
<span class="normal">148</span>
<span class="normal">149</span>
<span class="normal">150</span>
<span class="normal">151</span>
<span class="normal">152</span>
<span class="normal">153</span>
<span class="normal">154</span>
<span class="normal">155</span>
<span class="normal">156</span>
<span class="normal">157</span>
<span class="normal">158</span>
<span class="normal">159</span>
<span class="normal">160</span>
<span class="normal">161</span>
<span class="normal">162</span>
<span class="normal">163</span>
<span class="normal">164</span>
<span class="normal">165</span>
<span class="normal">166</span>
<span class="normal">167</span>
<span class="normal">168</span>
<span class="normal">169</span>
<span class="normal">170</span>
<span class="normal">171</span>
<span class="normal">172</span>
<span class="normal">173</span>
<span class="normal">174</span>
<span class="normal">175</span>
<span class="normal">176</span>
<span class="normal">177</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">get_shap_values</span><span class="p">(</span><span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="n">model</span><span class="p">:</span> <span class="n">Callable</span><span class="p">,</span> <span class="n">type_model</span><span class="o">=</span><span class="s2">&quot;tree&quot;</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span> <span class="nb">float</span><span class="p">]:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Calculates the SHAP values and expected average shap value for a given dataset and model.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (numpy.ndarray or pandas.DataFrame): The input dataset.</span>
<span class="sd">        model: The trained model object.</span>
<span class="sd">        type_model (str): type of model: tree based or other. If &quot;tree&quot; then TreeExplainer will be use, otherwise a general explainer from the SHAP package is used. Defaults to &#39;tree&#39;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        tuple: A tuple containing the SHAP values and the Average shap value.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; # Imports</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from xgboost import XGBClassifier</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.datasets import load_iris</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.model_selection import train_test_split</span>
<span class="sd">        &gt;&gt;&gt; # Imports SHAP Package</span>
<span class="sd">        &gt;&gt;&gt; import shap</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Load the iris dataset</span>
<span class="sd">        &gt;&gt;&gt; iris = load_iris()</span>
<span class="sd">        &gt;&gt;&gt; X, y = iris.data, iris.target</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Split the dataset into train and test sets</span>
<span class="sd">        &gt;&gt;&gt; X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Train a model</span>
<span class="sd">        &gt;&gt;&gt; model = XGBClassifier()</span>
<span class="sd">        &gt;&gt;&gt; model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate SHAP values and expected value</span>
<span class="sd">        &gt;&gt;&gt; shap_values, expected_value = get_shap_tree_values(X_test, model)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">type_model</span> <span class="o">==</span> <span class="s2">&quot;tree&quot;</span><span class="p">:</span>
        <span class="n">shap_explainer</span> <span class="o">=</span> <span class="n">TreeExplainer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">shap_valid</span> <span class="o">=</span> <span class="n">shap_explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">shap_expected_value</span> <span class="o">=</span> <span class="n">shap_explainer</span><span class="o">.</span><span class="n">expected_value</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">shap_explainer</span> <span class="o">=</span> <span class="n">Explainer</span><span class="p">(</span><span class="n">model</span><span class="p">)</span>
        <span class="n">shap_valid</span> <span class="o">=</span> <span class="n">shap_explainer</span><span class="o">.</span><span class="n">shap_values</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
        <span class="n">shap_expected_value</span> <span class="o">=</span> <span class="n">shap_explainer</span><span class="o">.</span><span class="n">expected_value</span>

    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">shap_valid</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">shap_valid</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">concatenate</span><span class="p">(</span><span class="n">shap_valid</span><span class="p">,</span> <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">shap_valid</span><span class="p">,</span> <span class="n">shap_expected_value</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.plot_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_data</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">main_feature</span><span class="p">,</span> <span class="n">other_features</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s1">&#39;qcut&#39;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plot data based on the provided DataFrame and features.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>temp</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The DataFrame containing the data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>main_feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The main feature to plot.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>other_features</code></td>
          <td>
                <code><span title="typing.Optional">Optional</span>[<span title="typing.Union">Union</span>[str, <span title="typing.List">List</span>[str]]]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Other features to include in the plot. Defaults to None.</p>
            </div>
          </td>
          <td>
                <code>None</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>nbins</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins. Defaults to 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_bins</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of binning. Defaults to "qcut".</p>
            </div>
          </td>
          <td>
                <code>&#39;qcut&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_plot</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plot. Defaults to "prob".</p>
            </div>
          </td>
          <td>
                <code>&#39;prob&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_data</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="s2">&quot;main_feature&quot;</span><span class="p">,</span> <span class="n">other_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature_1&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_2&quot;</span><span class="p">],</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">322</span>
<span class="normal">323</span>
<span class="normal">324</span>
<span class="normal">325</span>
<span class="normal">326</span>
<span class="normal">327</span>
<span class="normal">328</span>
<span class="normal">329</span>
<span class="normal">330</span>
<span class="normal">331</span>
<span class="normal">332</span>
<span class="normal">333</span>
<span class="normal">334</span>
<span class="normal">335</span>
<span class="normal">336</span>
<span class="normal">337</span>
<span class="normal">338</span>
<span class="normal">339</span>
<span class="normal">340</span>
<span class="normal">341</span>
<span class="normal">342</span>
<span class="normal">343</span>
<span class="normal">344</span>
<span class="normal">345</span>
<span class="normal">346</span>
<span class="normal">347</span>
<span class="normal">348</span>
<span class="normal">349</span>
<span class="normal">350</span>
<span class="normal">351</span>
<span class="normal">352</span>
<span class="normal">353</span>
<span class="normal">354</span>
<span class="normal">355</span>
<span class="normal">356</span>
<span class="normal">357</span>
<span class="normal">358</span>
<span class="normal">359</span>
<span class="normal">360</span>
<span class="normal">361</span>
<span class="normal">362</span>
<span class="normal">363</span>
<span class="normal">364</span>
<span class="normal">365</span>
<span class="normal">366</span>
<span class="normal">367</span>
<span class="normal">368</span>
<span class="normal">369</span>
<span class="normal">370</span>
<span class="normal">371</span>
<span class="normal">372</span>
<span class="normal">373</span>
<span class="normal">374</span>
<span class="normal">375</span>
<span class="normal">376</span>
<span class="normal">377</span>
<span class="normal">378</span>
<span class="normal">379</span>
<span class="normal">380</span>
<span class="normal">381</span>
<span class="normal">382</span>
<span class="normal">383</span>
<span class="normal">384</span>
<span class="normal">385</span>
<span class="normal">386</span>
<span class="normal">387</span>
<span class="normal">388</span>
<span class="normal">389</span>
<span class="normal">390</span>
<span class="normal">391</span>
<span class="normal">392</span>
<span class="normal">393</span>
<span class="normal">394</span>
<span class="normal">395</span>
<span class="normal">396</span>
<span class="normal">397</span>
<span class="normal">398</span>
<span class="normal">399</span>
<span class="normal">400</span>
<span class="normal">401</span>
<span class="normal">402</span>
<span class="normal">403</span>
<span class="normal">404</span>
<span class="normal">405</span>
<span class="normal">406</span>
<span class="normal">407</span>
<span class="normal">408</span>
<span class="normal">409</span>
<span class="normal">410</span>
<span class="normal">411</span>
<span class="normal">412</span>
<span class="normal">413</span>
<span class="normal">414</span>
<span class="normal">415</span>
<span class="normal">416</span>
<span class="normal">417</span>
<span class="normal">418</span>
<span class="normal">419</span>
<span class="normal">420</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_data</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="n">temp</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">main_feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">other_features</span><span class="p">:</span> <span class="n">Optional</span><span class="p">[</span><span class="n">Union</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">]]]</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
    <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot data based on the provided DataFrame and features.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp (pd.DataFrame): The DataFrame containing the data.</span>
<span class="sd">        main_feature (str): The main feature to plot.</span>
<span class="sd">        other_features (Optional[Union[str, List[str]]], optional): Other features to include in the plot. Defaults to None.</span>
<span class="sd">        nbins (int, optional): The number of bins. Defaults to 20.</span>
<span class="sd">        type_bins (str, optional): The type of binning. Defaults to &quot;qcut&quot;.</span>
<span class="sd">        type_plot (str, optional): The type of plot. Defaults to &quot;prob&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; temp = pd.DataFrame(...)</span>
<span class="sd">        &gt;&gt;&gt; plot_data(temp, &quot;main_feature&quot;, other_features=[&quot;feature_1&quot;, &quot;feature_2&quot;], nbins=10, type_bins=&quot;cut&quot;, type_plot=&quot;raw&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">other_features</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
        <span class="n">other_features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">other_features</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">other_features</span> <span class="o">=</span> <span class="p">[</span><span class="n">other_features</span><span class="p">]</span>
    <span class="n">features</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">features</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">main_feature</span><span class="p">)</span>
    <span class="n">features</span><span class="o">.</span><span class="n">extend</span><span class="p">(</span><span class="n">other_features</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="n">main_feature</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">main_feature</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">type_bins</span> <span class="o">==</span> <span class="s2">&quot;cut&quot;</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">main_feature</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">type_bins</span> <span class="o">==</span> <span class="s2">&quot;qcut&quot;</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">main_feature</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid type_bins value&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate the means for each bin</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">means_shap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">type_plot</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_others</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_other&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_model</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
            <span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_prob&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_others</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_prob_other&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_model</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_prob_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Calculate the counts for each bin</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="c1"># Create a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Add bar plot for counts on the primary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">))</span>

    <span class="c1"># Add line plots on the secondary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Observed&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">))</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
            <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
                <span class="n">x</span><span class="o">=</span><span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
                <span class="n">y</span><span class="o">=</span><span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span>
                <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
                <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2"> shap Mean&quot;</span><span class="p">,</span>
                <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap_others</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">means_shap_others</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Others shaps&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">means_shap_model</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Model shaps&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Update layout to include a secondary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;tickformat&quot;</span><span class="p">:</span> <span class="s2">&quot;.0%&quot;</span><span class="p">},</span>
        <span class="n">yaxis2</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Avg.&quot;</span><span class="p">,</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;overlaying&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.plot_data_compare" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_data_compare</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s1">&#39;qcut&#39;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plot data based on the provided DataFrame and feature in a way to compare a specific shap.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>temp</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The DataFrame containing the data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The main feature to plot.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>nbins</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins. Defaults to 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_bins</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of binning. Defaults to "qcut".</p>
            </div>
          </td>
          <td>
                <code>&#39;qcut&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_plot</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plot. Defaults to "prob".</p>
            </div>
          </td>
          <td>
                <code>&#39;prob&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_data</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="s2">&quot;feature_name&quot;</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">464</span>
<span class="normal">465</span>
<span class="normal">466</span>
<span class="normal">467</span>
<span class="normal">468</span>
<span class="normal">469</span>
<span class="normal">470</span>
<span class="normal">471</span>
<span class="normal">472</span>
<span class="normal">473</span>
<span class="normal">474</span>
<span class="normal">475</span>
<span class="normal">476</span>
<span class="normal">477</span>
<span class="normal">478</span>
<span class="normal">479</span>
<span class="normal">480</span>
<span class="normal">481</span>
<span class="normal">482</span>
<span class="normal">483</span>
<span class="normal">484</span>
<span class="normal">485</span>
<span class="normal">486</span>
<span class="normal">487</span>
<span class="normal">488</span>
<span class="normal">489</span>
<span class="normal">490</span>
<span class="normal">491</span>
<span class="normal">492</span>
<span class="normal">493</span>
<span class="normal">494</span>
<span class="normal">495</span>
<span class="normal">496</span>
<span class="normal">497</span>
<span class="normal">498</span>
<span class="normal">499</span>
<span class="normal">500</span>
<span class="normal">501</span>
<span class="normal">502</span>
<span class="normal">503</span>
<span class="normal">504</span>
<span class="normal">505</span>
<span class="normal">506</span>
<span class="normal">507</span>
<span class="normal">508</span>
<span class="normal">509</span>
<span class="normal">510</span>
<span class="normal">511</span>
<span class="normal">512</span>
<span class="normal">513</span>
<span class="normal">514</span>
<span class="normal">515</span>
<span class="normal">516</span>
<span class="normal">517</span>
<span class="normal">518</span>
<span class="normal">519</span>
<span class="normal">520</span>
<span class="normal">521</span>
<span class="normal">522</span>
<span class="normal">523</span>
<span class="normal">524</span>
<span class="normal">525</span>
<span class="normal">526</span>
<span class="normal">527</span>
<span class="normal">528</span>
<span class="normal">529</span>
<span class="normal">530</span>
<span class="normal">531</span>
<span class="normal">532</span>
<span class="normal">533</span>
<span class="normal">534</span>
<span class="normal">535</span>
<span class="normal">536</span>
<span class="normal">537</span>
<span class="normal">538</span>
<span class="normal">539</span>
<span class="normal">540</span>
<span class="normal">541</span>
<span class="normal">542</span>
<span class="normal">543</span>
<span class="normal">544</span>
<span class="normal">545</span>
<span class="normal">546</span>
<span class="normal">547</span>
<span class="normal">548</span>
<span class="normal">549</span>
<span class="normal">550</span>
<span class="normal">551</span>
<span class="normal">552</span>
<span class="normal">553</span>
<span class="normal">554</span>
<span class="normal">555</span>
<span class="normal">556</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_data_compare</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="n">temp</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
    <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot data based on the provided DataFrame and feature in a way to compare a specific shap.</span>

<span class="sd">    Args:</span>
<span class="sd">        temp (pd.DataFrame): The DataFrame containing the data.</span>
<span class="sd">        feature (str): The main feature to plot.</span>
<span class="sd">        nbins (int, optional): The number of bins. Defaults to 20.</span>
<span class="sd">        type_bins (str, optional): The type of binning. Defaults to &quot;qcut&quot;.</span>
<span class="sd">        type_plot (str, optional): The type of plot. Defaults to &quot;prob&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; temp = pd.DataFrame(...)</span>
<span class="sd">        &gt;&gt;&gt; plot_data(temp, &quot;feature_name&quot;, nbins=10, type_bins=&quot;cut&quot;, type_plot=&quot;raw&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">temp</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">type_bins</span> <span class="o">==</span> <span class="s2">&quot;cut&quot;</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">type_bins</span> <span class="o">==</span> <span class="s2">&quot;qcut&quot;</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">temp</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid type_bins value&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate the means for each bin</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="n">means_shap</span> <span class="o">=</span> <span class="p">{}</span>
    <span class="k">if</span> <span class="n">type_plot</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
        <span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_compare&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_compare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_model</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_prob&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_compare&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_prob_compare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_model</span> <span class="o">=</span> <span class="n">temp</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_prob_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Calculate the counts for each bin</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="c1"># Create a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Add bar plot for counts on the primary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">))</span>

    <span class="c1"># Add line plots on the secondary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Observed&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">means_shap</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2"> shap Mean&quot;</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_compare&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">means_shap</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_compare&quot;</span><span class="p">],</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2"> shap Mean compare&quot;</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">means_shap_model</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Model shaps&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Update layout to include a secondary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;tickformat&quot;</span><span class="p">:</span> <span class="s2">&quot;.0%&quot;</span><span class="p">},</span>
        <span class="n">yaxis2</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Avg.&quot;</span><span class="p">,</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;overlaying&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.plot_data_neutral" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">plot_data_neutral</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s1">&#39;qcut&#39;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s1">&#39;prob&#39;</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Plot data based on the provided neutralized DataFrame and features.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>data</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The DataFrame containing the neutralize shap data.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The main feature to plot on the x-axis.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>nbins</code></td>
          <td>
                <code>int</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The number of bins. Defaults to 20.</p>
            </div>
          </td>
          <td>
                <code>20</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_bins</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of binning. Defaults to "qcut".</p>
            </div>
          </td>
          <td>
                <code>&#39;qcut&#39;</code>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>type_plot</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The type of plot. Defaults to "prob".</p>
            </div>
          </td>
          <td>
                <code>&#39;prob&#39;</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code>None</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>None</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">plot_data_neutral</span><span class="p">(</span><span class="n">temp</span><span class="p">,</span> <span class="s2">&quot;main_feature&quot;</span><span class="p">,</span> <span class="n">other_features</span><span class="o">=</span><span class="p">[</span><span class="s2">&quot;feature_1&quot;</span><span class="p">,</span> <span class="s2">&quot;feature_2&quot;</span><span class="p">],</span> <span class="n">nbins</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">type_bins</span><span class="o">=</span><span class="s2">&quot;cut&quot;</span><span class="p">,</span> <span class="n">type_plot</span><span class="o">=</span><span class="s2">&quot;raw&quot;</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">601</span>
<span class="normal">602</span>
<span class="normal">603</span>
<span class="normal">604</span>
<span class="normal">605</span>
<span class="normal">606</span>
<span class="normal">607</span>
<span class="normal">608</span>
<span class="normal">609</span>
<span class="normal">610</span>
<span class="normal">611</span>
<span class="normal">612</span>
<span class="normal">613</span>
<span class="normal">614</span>
<span class="normal">615</span>
<span class="normal">616</span>
<span class="normal">617</span>
<span class="normal">618</span>
<span class="normal">619</span>
<span class="normal">620</span>
<span class="normal">621</span>
<span class="normal">622</span>
<span class="normal">623</span>
<span class="normal">624</span>
<span class="normal">625</span>
<span class="normal">626</span>
<span class="normal">627</span>
<span class="normal">628</span>
<span class="normal">629</span>
<span class="normal">630</span>
<span class="normal">631</span>
<span class="normal">632</span>
<span class="normal">633</span>
<span class="normal">634</span>
<span class="normal">635</span>
<span class="normal">636</span>
<span class="normal">637</span>
<span class="normal">638</span>
<span class="normal">639</span>
<span class="normal">640</span>
<span class="normal">641</span>
<span class="normal">642</span>
<span class="normal">643</span>
<span class="normal">644</span>
<span class="normal">645</span>
<span class="normal">646</span>
<span class="normal">647</span>
<span class="normal">648</span>
<span class="normal">649</span>
<span class="normal">650</span>
<span class="normal">651</span>
<span class="normal">652</span>
<span class="normal">653</span>
<span class="normal">654</span>
<span class="normal">655</span>
<span class="normal">656</span>
<span class="normal">657</span>
<span class="normal">658</span>
<span class="normal">659</span>
<span class="normal">660</span>
<span class="normal">661</span>
<span class="normal">662</span>
<span class="normal">663</span>
<span class="normal">664</span>
<span class="normal">665</span>
<span class="normal">666</span>
<span class="normal">667</span>
<span class="normal">668</span>
<span class="normal">669</span>
<span class="normal">670</span>
<span class="normal">671</span>
<span class="normal">672</span>
<span class="normal">673</span>
<span class="normal">674</span>
<span class="normal">675</span>
<span class="normal">676</span>
<span class="normal">677</span>
<span class="normal">678</span>
<span class="normal">679</span>
<span class="normal">680</span>
<span class="normal">681</span>
<span class="normal">682</span>
<span class="normal">683</span>
<span class="normal">684</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">plot_data_neutral</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="n">data</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">nbins</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="mi">20</span><span class="p">,</span>
    <span class="n">type_bins</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;qcut&quot;</span><span class="p">,</span>
    <span class="n">type_plot</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;prob&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Plot data based on the provided neutralized DataFrame and features.</span>

<span class="sd">    Args:</span>
<span class="sd">        data (pd.DataFrame): The DataFrame containing the neutralize shap data.</span>
<span class="sd">        feature (str): The main feature to plot on the x-axis.</span>
<span class="sd">        nbins (int, optional): The number of bins. Defaults to 20.</span>
<span class="sd">        type_bins (str, optional): The type of binning. Defaults to &quot;qcut&quot;.</span>
<span class="sd">        type_plot (str, optional): The type of plot. Defaults to &quot;prob&quot;.</span>

<span class="sd">    Returns:</span>
<span class="sd">        None</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; temp = pd.DataFrame(...)</span>
<span class="sd">        &gt;&gt;&gt; plot_data_neutral(temp, &quot;main_feature&quot;, other_features=[&quot;feature_1&quot;, &quot;feature_2&quot;], nbins=10, type_bins=&quot;cut&quot;, type_plot=&quot;raw&quot;)</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">unique</span><span class="p">()</span><span class="o">.</span><span class="n">shape</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">&lt;</span> <span class="mi">25</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">type_bins</span> <span class="o">==</span> <span class="s2">&quot;cut&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">cut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">bins</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">type_bins</span> <span class="o">==</span> <span class="s2">&quot;qcut&quot;</span><span class="p">:</span>
        <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">qcut</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">feature</span><span class="p">],</span> <span class="n">q</span><span class="o">=</span><span class="n">nbins</span><span class="p">)</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;Invalid type_bins value&quot;</span><span class="p">)</span>

    <span class="c1"># Calculate the means for each bin</span>
    <span class="n">means</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;target&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="k">if</span> <span class="n">type_plot</span> <span class="o">==</span> <span class="s2">&quot;raw&quot;</span><span class="p">:</span>
        <span class="n">means_shap_others</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_other&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_model</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">means_shap_others</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_prob_other&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
        <span class="n">means_shap_model</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">groupby</span><span class="p">(</span><span class="s2">&quot;bins&quot;</span><span class="p">,</span> <span class="n">observed</span><span class="o">=</span><span class="kc">True</span><span class="p">)[</span><span class="s2">&quot;shap_prob_model&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>

    <span class="c1"># Calculate the counts for each bin</span>
    <span class="n">counts</span> <span class="o">=</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;bins&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">value_counts</span><span class="p">(</span><span class="n">normalize</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span><span class="o">.</span><span class="n">sort_index</span><span class="p">()</span>

    <span class="c1"># Create a figure</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">go</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>

    <span class="c1"># Add bar plot for counts on the primary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Bar</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">counts</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">counts</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Data&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y&quot;</span><span class="p">,</span> <span class="n">marker_color</span><span class="o">=</span><span class="s2">&quot;lightgray&quot;</span><span class="p">))</span>

    <span class="c1"># Add line plots on the secondary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span><span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span><span class="n">x</span><span class="o">=</span><span class="n">means</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span> <span class="n">y</span><span class="o">=</span><span class="n">means</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span> <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Observed&quot;</span><span class="p">,</span> <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">))</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap_others</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">means_shap_others</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Neutralized shaps&quot;</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">add_trace</span><span class="p">(</span>
        <span class="n">go</span><span class="o">.</span><span class="n">Scatter</span><span class="p">(</span>
            <span class="n">x</span><span class="o">=</span><span class="n">means_shap_model</span><span class="o">.</span><span class="n">index</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">str</span><span class="p">),</span>
            <span class="n">y</span><span class="o">=</span><span class="n">means_shap_model</span><span class="p">,</span>
            <span class="n">mode</span><span class="o">=</span><span class="s2">&quot;lines&quot;</span><span class="p">,</span>
            <span class="n">name</span><span class="o">=</span><span class="s2">&quot;Original Model shaps&quot;</span><span class="p">,</span>
            <span class="n">yaxis</span><span class="o">=</span><span class="s2">&quot;y2&quot;</span><span class="p">,</span>
        <span class="p">)</span>
    <span class="p">)</span>

    <span class="c1"># Update layout to include a secondary y-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_layout</span><span class="p">(</span>
        <span class="n">yaxis</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Counts&quot;</span><span class="p">,</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;left&quot;</span><span class="p">,</span> <span class="s2">&quot;tickformat&quot;</span><span class="p">:</span> <span class="s2">&quot;.0%&quot;</span><span class="p">},</span>
        <span class="n">yaxis2</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;title&quot;</span><span class="p">:</span> <span class="s2">&quot;Avg.&quot;</span><span class="p">,</span> <span class="s2">&quot;side&quot;</span><span class="p">:</span> <span class="s2">&quot;right&quot;</span><span class="p">,</span> <span class="s2">&quot;overlaying&quot;</span><span class="p">:</span> <span class="s2">&quot;y&quot;</span><span class="p">},</span>
    <span class="p">)</span>
    <span class="c1"># Add title to x-axis</span>
    <span class="n">fig</span><span class="o">.</span><span class="n">update_xaxes</span><span class="p">(</span><span class="n">title_text</span><span class="o">=</span><span class="n">feature</span><span class="p">)</span>

    <span class="n">fig</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.random_sort_shaps" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">random_sort_shaps</span><span class="p">(</span><span class="n">shaps_values</span><span class="p">,</span> <span class="n">shap_expected_value</span><span class="p">,</span> <span class="n">feature_name</span><span class="p">,</span> <span class="n">y_target</span><span class="p">,</span> <span class="n">link_model</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Randomly shuffles the values of a specific feature in the SHAP values DataFrame,
calculates the row sum, and returns the ROC AUC score.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>shaps_values</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The SHAP values DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>shap_expected_value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The expected SHAP value.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>feature_name</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the feature to shuffle.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>y_target</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="pandas.Series">Series</span>, <span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target variable.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>link_model</code></td>
          <td>
                <code>aprofs model object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An object that allows to calculate the performance of the model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The ROC AUC score.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate synthetic data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Train a logistic regression model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate SHAP values and expected value</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shap_values</span><span class="p">,</span> <span class="n">expected_value</span> <span class="o">=</span> <span class="n">get_shap_tree_values</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate ROC AUC score with shuffled feature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roc_score</span> <span class="o">=</span> <span class="n">random_sort_shaps</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">expected_value</span><span class="p">,</span> <span class="s1">&#39;feature_1&#39;</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="n">link_function</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">roc_score</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">197</span>
<span class="normal">198</span>
<span class="normal">199</span>
<span class="normal">200</span>
<span class="normal">201</span>
<span class="normal">202</span>
<span class="normal">203</span>
<span class="normal">204</span>
<span class="normal">205</span>
<span class="normal">206</span>
<span class="normal">207</span>
<span class="normal">208</span>
<span class="normal">209</span>
<span class="normal">210</span>
<span class="normal">211</span>
<span class="normal">212</span>
<span class="normal">213</span>
<span class="normal">214</span>
<span class="normal">215</span>
<span class="normal">216</span>
<span class="normal">217</span>
<span class="normal">218</span>
<span class="normal">219</span>
<span class="normal">220</span>
<span class="normal">221</span>
<span class="normal">222</span>
<span class="normal">223</span>
<span class="normal">224</span>
<span class="normal">225</span>
<span class="normal">226</span>
<span class="normal">227</span>
<span class="normal">228</span>
<span class="normal">229</span>
<span class="normal">230</span>
<span class="normal">231</span>
<span class="normal">232</span>
<span class="normal">233</span>
<span class="normal">234</span>
<span class="normal">235</span>
<span class="normal">236</span>
<span class="normal">237</span>
<span class="normal">238</span>
<span class="normal">239</span>
<span class="normal">240</span>
<span class="normal">241</span>
<span class="normal">242</span>
<span class="normal">243</span>
<span class="normal">244</span>
<span class="normal">245</span>
<span class="normal">246</span>
<span class="normal">247</span>
<span class="normal">248</span>
<span class="normal">249</span>
<span class="normal">250</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">random_sort_shaps</span><span class="p">(</span>
    <span class="n">shaps_values</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">shap_expected_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">feature_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">y_target</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">link_model</span><span class="p">:</span> <span class="n">LinkModels</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Randomly shuffles the values of a specific feature in the SHAP values DataFrame,</span>
<span class="sd">    calculates the row sum, and returns the ROC AUC score.</span>

<span class="sd">    Args:</span>
<span class="sd">        shaps_values (pd.DataFrame): The SHAP values DataFrame.</span>
<span class="sd">        shap_expected_value (float): The expected SHAP value.</span>
<span class="sd">        feature_name (str): The name of the feature to shuffle.</span>
<span class="sd">        y_target (Union[pd.Series, np.ndarray]): The target variable.</span>
<span class="sd">        link_model (aprofs model object): An object that allows to calculate the performance of the model.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The ROC AUC score.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.datasets import make_classification</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.linear_model import LogisticRegression</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.model_selection import train_test_split</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import roc_auc_score</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Generate synthetic data</span>
<span class="sd">        &gt;&gt;&gt; X, y = make_classification(n_samples=100, n_features=5, random_state=42)</span>
<span class="sd">        &gt;&gt;&gt; X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Train a logistic regression model</span>
<span class="sd">        &gt;&gt;&gt; model = LogisticRegression()</span>
<span class="sd">        &gt;&gt;&gt; model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate SHAP values and expected value</span>
<span class="sd">        &gt;&gt;&gt; shap_values, expected_value = get_shap_tree_values(X_test, model)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate ROC AUC score with shuffled feature</span>
<span class="sd">        &gt;&gt;&gt; roc_score = random_sort_shaps(shap_values, expected_value, &#39;feature_1&#39;, y_test, link_function=&#39;logistic&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(roc_score)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shaps_values_shuffled</span> <span class="o">=</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shuffle</span>
    <span class="n">shaps_values_shuffled</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">new_shap_table</span> <span class="o">=</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_shap_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">new_shap_table</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">shaps_values_shuffled</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>
    <span class="n">approx_pred_valid</span> <span class="o">=</span> <span class="n">calculate_all_row_sum</span><span class="p">(</span><span class="n">new_shap_table</span><span class="p">,</span> <span class="n">shap_expected_value</span><span class="p">,</span> <span class="n">link_model</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">link_model</span><span class="o">.</span><span class="n">performance_fit</span><span class="p">(</span><span class="n">y_target</span><span class="p">,</span> <span class="n">approx_pred_valid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.random_sort_shaps_column" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">random_sort_shaps_column</span><span class="p">(</span><span class="n">shaps_values</span><span class="p">,</span> <span class="n">shap_mean_value</span><span class="p">,</span> <span class="n">target_column</span><span class="p">,</span> <span class="n">feature</span><span class="p">,</span> <span class="n">link_model</span><span class="p">,</span> <span class="n">original</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Randomly shuffles the values of a specific feature in the SHAP values DataFrame,
calculates the row sum, and returns the ROC AUC score.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>shaps_values</code></td>
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The SHAP values DataFrame.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>shap_mean_value</code></td>
          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The mean SHAP value.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>target_column</code></td>
          <td>
                <code><span title="typing.Union">Union</span>[<span title="pandas.Series">Series</span>, <span title="numpy.ndarray">ndarray</span>]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The target variable.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The name of the feature to shuffle.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>link_model</code></td>
          <td>
                <code>aprofs model object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An object that allows to calculate the performance of the model.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>original</code></td>
          <td>
                <code>bool</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>Whether to use the original feature values or shuffled values. Defaults to False.</p>
            </div>
          </td>
          <td>
                <code>False</code>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
<th>Name</th>        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
<td><code>float</code></td>          <td>
                <code>float</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>The ROC AUC score.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.datasets</span> <span class="kn">import</span> <span class="n">make_classification</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.linear_model</span> <span class="kn">import</span> <span class="n">LogisticRegression</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.model_selection</span> <span class="kn">import</span> <span class="n">train_test_split</span>
<span class="gp">&gt;&gt;&gt; </span><span class="kn">from</span> <span class="nn">sklearn.metrics</span> <span class="kn">import</span> <span class="n">roc_auc_score</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Generate synthetic data</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X</span><span class="p">,</span> <span class="n">y</span> <span class="o">=</span> <span class="n">make_classification</span><span class="p">(</span><span class="n">n_samples</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">n_features</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">X_train</span><span class="p">,</span> <span class="n">X_test</span><span class="p">,</span> <span class="n">y_train</span><span class="p">,</span> <span class="n">y_test</span> <span class="o">=</span> <span class="n">train_test_split</span><span class="p">(</span><span class="n">X</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">test_size</span><span class="o">=</span><span class="mf">0.2</span><span class="p">,</span> <span class="n">random_state</span><span class="o">=</span><span class="mi">42</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Train a logistic regression model</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span> <span class="o">=</span> <span class="n">LogisticRegression</span><span class="p">()</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">model</span><span class="o">.</span><span class="n">fit</span><span class="p">(</span><span class="n">X_train</span><span class="p">,</span> <span class="n">y_train</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate SHAP values and expected value</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">shap_values</span><span class="p">,</span> <span class="n">expected_value</span> <span class="o">=</span> <span class="n">get_shap_tree_values</span><span class="p">(</span><span class="n">X_test</span><span class="p">,</span> <span class="n">model</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="c1"># Calculate ROC AUC score with shuffled feature</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">roc_score</span> <span class="o">=</span> <span class="n">random_sort_shaps_column</span><span class="p">(</span><span class="n">shap_values</span><span class="p">,</span> <span class="n">expected_value</span><span class="p">,</span> <span class="n">y_test</span><span class="p">,</span> <span class="s1">&#39;feature_1&#39;</span><span class="p">,</span> <span class="n">link_function</span><span class="o">=</span><span class="s1">&#39;logistic&#39;</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">roc_score</span><span class="p">)</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">253</span>
<span class="normal">254</span>
<span class="normal">255</span>
<span class="normal">256</span>
<span class="normal">257</span>
<span class="normal">258</span>
<span class="normal">259</span>
<span class="normal">260</span>
<span class="normal">261</span>
<span class="normal">262</span>
<span class="normal">263</span>
<span class="normal">264</span>
<span class="normal">265</span>
<span class="normal">266</span>
<span class="normal">267</span>
<span class="normal">268</span>
<span class="normal">269</span>
<span class="normal">270</span>
<span class="normal">271</span>
<span class="normal">272</span>
<span class="normal">273</span>
<span class="normal">274</span>
<span class="normal">275</span>
<span class="normal">276</span>
<span class="normal">277</span>
<span class="normal">278</span>
<span class="normal">279</span>
<span class="normal">280</span>
<span class="normal">281</span>
<span class="normal">282</span>
<span class="normal">283</span>
<span class="normal">284</span>
<span class="normal">285</span>
<span class="normal">286</span>
<span class="normal">287</span>
<span class="normal">288</span>
<span class="normal">289</span>
<span class="normal">290</span>
<span class="normal">291</span>
<span class="normal">292</span>
<span class="normal">293</span>
<span class="normal">294</span>
<span class="normal">295</span>
<span class="normal">296</span>
<span class="normal">297</span>
<span class="normal">298</span>
<span class="normal">299</span>
<span class="normal">300</span>
<span class="normal">301</span>
<span class="normal">302</span>
<span class="normal">303</span>
<span class="normal">304</span>
<span class="normal">305</span>
<span class="normal">306</span>
<span class="normal">307</span>
<span class="normal">308</span>
<span class="normal">309</span>
<span class="normal">310</span>
<span class="normal">311</span>
<span class="normal">312</span>
<span class="normal">313</span>
<span class="normal">314</span>
<span class="normal">315</span>
<span class="normal">316</span>
<span class="normal">317</span>
<span class="normal">318</span>
<span class="normal">319</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">random_sort_shaps_column</span><span class="p">(</span>  <span class="c1"># pylint: disable=too-many-arguments</span>
    <span class="n">shaps_values</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">,</span>
    <span class="n">shap_mean_value</span><span class="p">:</span> <span class="nb">float</span><span class="p">,</span>
    <span class="n">target_column</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">pd</span><span class="o">.</span><span class="n">Series</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">],</span>
    <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>
    <span class="n">link_model</span><span class="p">:</span> <span class="n">LinkModels</span><span class="p">,</span>
    <span class="n">original</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Randomly shuffles the values of a specific feature in the SHAP values DataFrame,</span>
<span class="sd">    calculates the row sum, and returns the ROC AUC score.</span>

<span class="sd">    Args:</span>
<span class="sd">        shaps_values (pd.DataFrame): The SHAP values DataFrame.</span>
<span class="sd">        shap_mean_value (float): The mean SHAP value.</span>
<span class="sd">        target_column (Union[pd.Series, np.ndarray]): The target variable.</span>
<span class="sd">        feature (str): The name of the feature to shuffle.</span>
<span class="sd">        link_model (aprofs model object): An object that allows to calculate the performance of the model.</span>
<span class="sd">        original (bool, optional): Whether to use the original feature values or shuffled values. Defaults to False.</span>

<span class="sd">    Returns:</span>
<span class="sd">        float: The ROC AUC score.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; import pandas as pd</span>
<span class="sd">        &gt;&gt;&gt; import numpy as np</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.datasets import make_classification</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.linear_model import LogisticRegression</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.model_selection import train_test_split</span>
<span class="sd">        &gt;&gt;&gt; from sklearn.metrics import roc_auc_score</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Generate synthetic data</span>
<span class="sd">        &gt;&gt;&gt; X, y = make_classification(n_samples=100, n_features=5, random_state=42)</span>
<span class="sd">        &gt;&gt;&gt; X_train, X_test, y_train, y_test = train_test_split(X, y, test_size=0.2, random_state=42)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Train a logistic regression model</span>
<span class="sd">        &gt;&gt;&gt; model = LogisticRegression()</span>
<span class="sd">        &gt;&gt;&gt; model.fit(X_train, y_train)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate SHAP values and expected value</span>
<span class="sd">        &gt;&gt;&gt; shap_values, expected_value = get_shap_tree_values(X_test, model)</span>
<span class="sd">        &gt;&gt;&gt;</span>
<span class="sd">        &gt;&gt;&gt; # Calculate ROC AUC score with shuffled feature</span>
<span class="sd">        &gt;&gt;&gt; roc_score = random_sort_shaps_column(shap_values, expected_value, y_test, &#39;feature_1&#39;, link_function=&#39;logistic&#39;)</span>
<span class="sd">        &gt;&gt;&gt; print(roc_score)</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">shaps_values_original</span> <span class="o">=</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">shaps_values_original</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="n">shaps_values_shuffled</span> <span class="o">=</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">sample</span><span class="p">(</span><span class="n">frac</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>  <span class="c1"># shuffle</span>
    <span class="n">shaps_values_shuffled</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="c1"># Calculate the average values of each column</span>
    <span class="n">average_values</span> <span class="o">=</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">mean</span><span class="p">()</span>
    <span class="n">new_shap_table</span> <span class="o">=</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>
    <span class="n">new_shap_table</span><span class="o">.</span><span class="n">reset_index</span><span class="p">(</span><span class="n">inplace</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">drop</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">feature_name</span> <span class="ow">in</span> <span class="n">shaps_values</span><span class="o">.</span><span class="n">columns</span><span class="p">:</span>
        <span class="n">new_shap_table</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">average_values</span><span class="p">[</span><span class="n">feature_name</span><span class="p">]</span>

    <span class="k">if</span> <span class="n">original</span><span class="p">:</span>
        <span class="n">new_shap_table</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">shaps_values_original</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">new_shap_table</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">shaps_values_shuffled</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span>

    <span class="n">approx_pred_valid</span> <span class="o">=</span> <span class="n">calculate_all_row_sum</span><span class="p">(</span><span class="n">new_shap_table</span><span class="p">,</span> <span class="n">shap_mean_value</span><span class="p">,</span> <span class="n">link_model</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">link_model</span><span class="o">.</span><span class="n">performance_fit</span><span class="p">(</span><span class="n">target_column</span><span class="p">,</span> <span class="n">approx_pred_valid</span><span class="p">)</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.temp_neutral_plot_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">temp_neutral_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generate a temporary DataFrame for plotting purposes.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>aprofs_obj</code></td>
          <td>
                <code>Aprofs Object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the Aprofs class.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of feature names that will be neutralized. The shapley values for this will be just the average values. This way the break the segmentation of the feature, maintaining the global effect of all the others.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: The temporary DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">aprofs_obj</span> <span class="o">=</span> <span class="n">Aprofs</span> <span class="n">Object</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature_1&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">temp_neutral_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">687</span>
<span class="normal">688</span>
<span class="normal">689</span>
<span class="normal">690</span>
<span class="normal">691</span>
<span class="normal">692</span>
<span class="normal">693</span>
<span class="normal">694</span>
<span class="normal">695</span>
<span class="normal">696</span>
<span class="normal">697</span>
<span class="normal">698</span>
<span class="normal">699</span>
<span class="normal">700</span>
<span class="normal">701</span>
<span class="normal">702</span>
<span class="normal">703</span>
<span class="normal">704</span>
<span class="normal">705</span>
<span class="normal">706</span>
<span class="normal">707</span>
<span class="normal">708</span>
<span class="normal">709</span>
<span class="normal">710</span>
<span class="normal">711</span>
<span class="normal">712</span>
<span class="normal">713</span>
<span class="normal">714</span>
<span class="normal">715</span>
<span class="normal">716</span>
<span class="normal">717</span>
<span class="normal">718</span>
<span class="normal">719</span>
<span class="normal">720</span>
<span class="normal">721</span>
<span class="normal">722</span>
<span class="normal">723</span>
<span class="normal">724</span>
<span class="normal">725</span>
<span class="normal">726</span>
<span class="normal">727</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">temp_neutral_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a temporary DataFrame for plotting purposes.</span>

<span class="sd">    Args:</span>
<span class="sd">        aprofs_obj (Aprofs Object): An instance of the Aprofs class.</span>
<span class="sd">        features (List[str]): A list of feature names that will be neutralized. The shapley values for this will be just the average values. This way the break the segmentation of the feature, maintaining the global effect of all the others.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The temporary DataFrame.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; aprofs_obj = Aprofs Object(...)</span>
<span class="sd">        &gt;&gt;&gt; features = [&#39;feature_1&#39;, &#39;feature_2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; temp = temp_neutral_plot_data(aprofs_obj, features)</span>
<span class="sd">        &gt;&gt;&gt; print(temp.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">features</span><span class="p">]</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">feat</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">current_data</span><span class="p">[</span><span class="n">feat</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>  <span class="c1"># adding features to data</span>

    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_other&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span>
        <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span>
        <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="p">[[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="p">[</span><span class="n">features</span><span class="p">]</span>
        <span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
        <span class="o">.</span><span class="n">mean</span><span class="p">()</span>  <span class="c1"># sums the columns of the features and calculate the average value</span>
    <span class="p">)</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_prob_other&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_other&quot;</span><span class="p">]))</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_prob_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">temp</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.temp_plot_compare_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">temp_plot_compare_data</span><span class="p">(</span><span class="n">aprofs_obj_self</span><span class="p">,</span> <span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generate a temporary DataFrame for plotting purposes.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>aprofs_obj_self</code></td>
          <td>
                <code>Aprofs Object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the Aprofs class.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>aprofs_obj</code></td>
          <td>
                <code>Aprofs Object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the Aprofs class.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>feature</code></td>
          <td>
                <code>str</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>feature to compare.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: The temporary DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">aprofs_obj</span> <span class="o">=</span> <span class="n">Aprofs</span> <span class="n">Object</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">aprofs_obj_2_compare</span> <span class="o">=</span> <span class="n">Aprofs</span> <span class="n">Object</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">features</span> <span class="o">=</span> <span class="s1">&#39;feature_1&#39;</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">temp_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span><span class="n">aprofs_obj_2_compare</span><span class="p">,</span> <span class="n">feature</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">559</span>
<span class="normal">560</span>
<span class="normal">561</span>
<span class="normal">562</span>
<span class="normal">563</span>
<span class="normal">564</span>
<span class="normal">565</span>
<span class="normal">566</span>
<span class="normal">567</span>
<span class="normal">568</span>
<span class="normal">569</span>
<span class="normal">570</span>
<span class="normal">571</span>
<span class="normal">572</span>
<span class="normal">573</span>
<span class="normal">574</span>
<span class="normal">575</span>
<span class="normal">576</span>
<span class="normal">577</span>
<span class="normal">578</span>
<span class="normal">579</span>
<span class="normal">580</span>
<span class="normal">581</span>
<span class="normal">582</span>
<span class="normal">583</span>
<span class="normal">584</span>
<span class="normal">585</span>
<span class="normal">586</span>
<span class="normal">587</span>
<span class="normal">588</span>
<span class="normal">589</span>
<span class="normal">590</span>
<span class="normal">591</span>
<span class="normal">592</span>
<span class="normal">593</span>
<span class="normal">594</span>
<span class="normal">595</span>
<span class="normal">596</span>
<span class="normal">597</span>
<span class="normal">598</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">temp_plot_compare_data</span><span class="p">(</span><span class="n">aprofs_obj_self</span><span class="p">,</span> <span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">feature</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a temporary DataFrame for plotting purposes.</span>

<span class="sd">    Args:</span>
<span class="sd">        aprofs_obj_self (Aprofs Object): An instance of the Aprofs class.</span>
<span class="sd">        aprofs_obj (Aprofs Object): An instance of the Aprofs class.</span>
<span class="sd">        feature (str): feature to compare.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The temporary DataFrame.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; aprofs_obj = Aprofs Object(...)</span>
<span class="sd">        &gt;&gt;&gt; aprofs_obj_2_compare = Aprofs Object(...)</span>
<span class="sd">        &gt;&gt;&gt; features = &#39;feature_1&#39;</span>
<span class="sd">        &gt;&gt;&gt; temp = temp_plot_data(aprofs_obj,aprofs_obj_2_compare, feature)</span>
<span class="sd">        &gt;&gt;&gt; print(temp.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">aprofs_obj_self</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="c1"># self data</span>
    <span class="n">temp</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj_self</span><span class="o">.</span><span class="n">current_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj_self</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj_self</span><span class="o">.</span><span class="n">shap_values</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]))</span>

    <span class="c1"># compare data</span>
    <span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_compare&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
    <span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_prob_compare&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_compare&quot;</span><span class="p">]))</span>

    <span class="c1"># model probabilities data</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_prob_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">temp</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>


<div class="doc doc-object doc-function">



<h2 id="src.aprofs.utils.temp_plot_data" class="doc doc-heading">
          <code class="highlight language-python"><span class="n">temp_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span></code>

</h2>


  <div class="doc doc-contents ">
  
      <p>Generate a temporary DataFrame for plotting purposes.</p>



  <p><span class="doc-section-title">Parameters:</span></p>
  <table>
    <thead>
      <tr>
        <th>Name</th>
        <th>Type</th>
        <th>Description</th>
        <th>Default</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td><code>aprofs_obj</code></td>
          <td>
                <code>Aprofs Object</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>An instance of the Aprofs class.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
        <tr class="doc-section-item">
          <td><code>features</code></td>
          <td>
                <code><span title="typing.List">List</span>[str]</code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>A list of feature names.</p>
            </div>
          </td>
          <td>
              <em>required</em>
          </td>
        </tr>
    </tbody>
  </table>



  <p><span class="doc-section-title">Returns:</span></p>
  <table>
    <thead>
      <tr>
        <th>Type</th>
        <th>Description</th>
      </tr>
    </thead>
    <tbody>
        <tr class="doc-section-item">
          <td>
                <code><span title="pandas.DataFrame">DataFrame</span></code>
          </td>
          <td>
            <div class="doc-md-description">
              <p>pd.DataFrame: The temporary DataFrame.</p>
            </div>
          </td>
        </tr>
    </tbody>
  </table>



<p><span class="doc-section-title">Examples:</span></p>
    <div class="highlight"><pre><span></span><code><span class="gp">&gt;&gt;&gt; </span><span class="n">aprofs_obj</span> <span class="o">=</span> <span class="n">Aprofs</span> <span class="n">Object</span><span class="p">(</span><span class="o">...</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;feature_1&#39;</span><span class="p">,</span> <span class="s1">&#39;feature_2&#39;</span><span class="p">]</span>
<span class="gp">&gt;&gt;&gt; </span><span class="n">temp</span> <span class="o">=</span> <span class="n">temp_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">features</span><span class="p">)</span>
<span class="gp">&gt;&gt;&gt; </span><span class="nb">print</span><span class="p">(</span><span class="n">temp</span><span class="o">.</span><span class="n">head</span><span class="p">())</span>
</code></pre></div>

          <details class="quote">
            <summary>Source code in <code>src/aprofs/utils.py</code></summary>
            <div class="highlight"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre><span></span><span class="normal">423</span>
<span class="normal">424</span>
<span class="normal">425</span>
<span class="normal">426</span>
<span class="normal">427</span>
<span class="normal">428</span>
<span class="normal">429</span>
<span class="normal">430</span>
<span class="normal">431</span>
<span class="normal">432</span>
<span class="normal">433</span>
<span class="normal">434</span>
<span class="normal">435</span>
<span class="normal">436</span>
<span class="normal">437</span>
<span class="normal">438</span>
<span class="normal">439</span>
<span class="normal">440</span>
<span class="normal">441</span>
<span class="normal">442</span>
<span class="normal">443</span>
<span class="normal">444</span>
<span class="normal">445</span>
<span class="normal">446</span>
<span class="normal">447</span>
<span class="normal">448</span>
<span class="normal">449</span>
<span class="normal">450</span>
<span class="normal">451</span>
<span class="normal">452</span>
<span class="normal">453</span>
<span class="normal">454</span>
<span class="normal">455</span>
<span class="normal">456</span>
<span class="normal">457</span>
<span class="normal">458</span>
<span class="normal">459</span>
<span class="normal">460</span>
<span class="normal">461</span></pre></div></td><td class="code"><div><pre><span></span><code><span class="k">def</span> <span class="nf">temp_plot_data</span><span class="p">(</span><span class="n">aprofs_obj</span><span class="p">,</span> <span class="n">features</span><span class="p">:</span> <span class="n">List</span><span class="p">[</span><span class="nb">str</span><span class="p">])</span> <span class="o">-&gt;</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">:</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generate a temporary DataFrame for plotting purposes.</span>

<span class="sd">    Args:</span>
<span class="sd">        aprofs_obj (Aprofs Object): An instance of the Aprofs class.</span>
<span class="sd">        features (List[str]): A list of feature names.</span>

<span class="sd">    Returns:</span>
<span class="sd">        pd.DataFrame: The temporary DataFrame.</span>

<span class="sd">    Examples:</span>
<span class="sd">        &gt;&gt;&gt; aprofs_obj = Aprofs Object(...)</span>
<span class="sd">        &gt;&gt;&gt; features = [&#39;feature_1&#39;, &#39;feature_2&#39;]</span>
<span class="sd">        &gt;&gt;&gt; temp = temp_plot_data(aprofs_obj, features)</span>
<span class="sd">        &gt;&gt;&gt; print(temp.head())</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">features</span><span class="p">,</span> <span class="nb">list</span><span class="p">):</span>
        <span class="n">features</span> <span class="o">=</span> <span class="p">[</span><span class="n">features</span><span class="p">]</span>

    <span class="n">temp</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
        <span class="p">{</span>
            <span class="s2">&quot;target&quot;</span><span class="p">:</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">target_column</span><span class="p">,</span>
        <span class="p">}</span>
    <span class="p">)</span>

    <span class="k">for</span> <span class="n">feature</span> <span class="ow">in</span> <span class="n">features</span><span class="p">:</span>
        <span class="n">temp</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">current_data</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="p">[</span><span class="n">feature</span><span class="p">]</span><span class="o">.</span><span class="n">values</span>
        <span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap_prob&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">feature</span><span class="si">}</span><span class="s2">_shap&quot;</span><span class="p">]))</span>

    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_other&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="p">[</span>
        <span class="p">[</span><span class="n">col</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">columns</span> <span class="k">if</span> <span class="n">col</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">features</span><span class="p">]</span>
    <span class="p">]</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_prob_other&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_other&quot;</span><span class="p">]))</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_mean</span> <span class="o">+</span> <span class="n">aprofs_obj</span><span class="o">.</span><span class="n">shap_values</span><span class="o">.</span><span class="n">sum</span><span class="p">(</span><span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_prob_model&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="p">(</span><span class="mi">1</span> <span class="o">+</span> <span class="n">np</span><span class="o">.</span><span class="n">exp</span><span class="p">(</span><span class="o">-</span><span class="n">temp</span><span class="p">[</span><span class="s2">&quot;shap_model&quot;</span><span class="p">]))</span>

    <span class="k">return</span> <span class="n">temp</span>
</code></pre></div></td></tr></table></div>
          </details>
  </div>

</div>



  </div>

  </div>

</div>












                
              </article>
            </div>
          
          
<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
  
    Made with
    <a href="https://squidfunk.github.io/mkdocs-material/" target="_blank" rel="noopener">
      Material for MkDocs
    </a>
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    
    <script id="__config" type="application/json">{"base": "..", "features": [], "search": "../assets/javascripts/workers/search.b8dbb3d2.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../assets/javascripts/bundle.3220b9d7.min.js"></script>
      
    
  </body>
</html>